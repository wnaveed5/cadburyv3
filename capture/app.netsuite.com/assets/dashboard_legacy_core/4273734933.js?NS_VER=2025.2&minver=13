NS.DashboardBackend=function(F,d,C){var w=Object.freeze({DASHBOARD:"dashboard",PORTLET:"portlet",PLUGIN:"plugin"});return function(k,t){function n(q){var p=d.Deferred();setTimeout(function(){p.resolve()},q);return p}function r(q,p,x){NS.Logger.error("Server error:\n"+p+"\n"+x);return d.Deferred().reject(q,p,x)}function f(q){return-1!=q.responseText.indexOf(b)||-1!=q.responseText.indexOf(h)||-1!=q.responseText.indexOf(a)}function l(q,p,x){return f(q)?d.Deferred().reject(q,u,h):d.Deferred().reject(q,
p,x)}function m(q,p,x){return f(x)?d.Deferred().reject(x,u,h):d.Deferred().resolve(q,p,x)}function e(q,p,x,B){return function(K,M,I){var L=d.Deferred();if("pending"===K.status)return q.notify({status:"pending",attempt:B}),n(K.wait).then(function(){var D=d.extend({},x,K.params),H=B+1,G=g(p,D);NS.Logger.debug("Re-sending to server, attempt "+H+": ",G);return d.ajax(G).then(e(q,p,D,H),l)});"ok"===K.status?L.resolve(K,M,I):L.reject(I,K.errorTitle,K.errorText);return L}}function g(q,p){q=d.extend({requestType:"GET",
dataType:"json"},q);if("POST"===q.requestType){var x=NS.getCSRFToken();p[x.name]=x.value}return{url:k,type:q.requestType,dataType:q.dataType,data:p,cache:!1}}function c(q,p){var x=g(q,p);NS.Logger.debug("Sending to server: ",x);var B=d.Deferred();d.ajax(x).then("json"===x.dataType?e(B,q,p,1):m,l).then(null,r).done(function(){B.resolve.apply(B,arguments)}).fail(function(){B.reject.apply(B,arguments)});return B}var b=NS.Translations.dictionary["NLErrormessageContext.SOMEONE_HAS_LOGGED_IN_AS_THIS_USER_FROM_A_DIFFERENT_COMPUTER_OR_BROWSER_WINDOW_ONLY_ONE_PERSON_MAY_LOGIN_AS_A_GIVEN_USER_AT_A_TIME_AS_A_CONSEQUENCE_THIS_SESSION_HAS_BEEN_TERMINATED_PTO_HAVE_MULTIPLE_WINDOWS_LOGGED_IN_AS_THE_SAME_USER_USE_FILENEWWINDOW_FROM_YOUR_BROWSERS_MENU_BAR"]||
"Someone has logged in as this user from a different computer or browser window.",a=NS.Translations.dictionary["NLErrormessageContext.YOUR_CONNECTION_HAS_TIMED_OUT__PLEASE_A_HREFPAGESLOGINJSP_TARGETSELFLOG_INA_AGAIN"]||"Your connection has timed out. Please",h=NS.Translations.dictionary["NLPagemessageContext.YOUR_SESSION_HAS_TIMED_OUT_PLEASE_LOG_IN_AGAIN"]||"Your session has timed out. Please log in again.",u=NS.Translations.dictionary["NLErrormessageContext.ERROR"]||"Error";return{_deferred:C,_action:function(q,
p){return this._deferred=c(q,p)},dashboardAction:function(q,p,x){q=d.extend({},t,x,{"action-target":w.DASHBOARD,action:q});return this._action(p,q)},portletAction:function(q,p,x,B){q=d.extend({},t,{"action-target":w.PORTLET,portletid:q,action:p});q="string"===typeof B?d.param(q)+"&"+B:d.extend(q,B);return this._action(x,q)},pluginAction:function(q,p,x,B){q=d.extend({},t,B,{"action-target":w.PLUGIN,plugin:q,action:p});return this._action(x,q)},onDone:function(q){this._deferred?this._deferred.done(q):
q()},onFail:function(q){this._deferred&&this._deferred.fail(q)}}}}(this,NS.jQuery);(function(F){NS.ColorPicker=function(d){function C(m){t=m;r.style.backgroundColor=t;n.setAttribute("data-color",t)}function w(){l&&(l=!1,f.classList.toggle("ns-picker-show"))}var k="rgb(255, 202, 0);rgb(244, 126, 37);rgb(178, 141, 2);rgb(100, 79, 0);rgb(246, 76, 96);rgb(255, 19, 0);rgb(197, 14, 0);rgb(155, 11, 0);rgb(83, 128, 166);rgb(3, 137, 156);rgb(128, 0, 128);rgb(0, 0, 255);rgb(39, 173, 64);rgb(0, 195, 34);rgb(0, 151, 26);rgb(0, 118, 21)".split(";");NS.UI.Util.isRedwood&&(k=["#e18212","#D63B25",
"#00688c","#508223"]);var t=d&&d.color||k[0],n,r,f,l=!1;(function(){n=document.createElement("div");n.className="ns-colorpicker";r=document.createElement("div");r.className="ns-colorpicker-button";r.onclick=function(){var m=r.getBoundingClientRect();f.classList.toggle("ns-picker-show");f.style.left=m.left+"px";f.style.top=m.bottom+"px";l=!0};f=document.createElement("div");f.className="ns-colorpicker-items";k.forEach(function(m){var e=document.createElement("div");e.className="ns-color-item";e.style.backgroundColor=
m;e.onclick=function(){C(m);w()};f.appendChild(e)});n.appendChild(r);n.appendChild(f);C(t);document.addEventListener("click",function(m){m.target!=r&&w()})})();return{element:n,set:function(m){C(m)},get:function(){return t}}}})(this);NS.Dashboard=function(F,d,C){function w(){return d(".ns-dashboard-templates > .ns-portlet-loader").clone()}function k(c,b){var a=d(".ns-dashboard-templates > .ns-message-component").clone();b=b instanceof Error?b.message:b;a.find("h3").text(c);a.find("p").html(b.replace(/(?:\r\n|\r|\n)/g,"<br />"));return a}function t(){d(".ns-dashboard-container").each(function(){var c=d(this),b=c.data("dashboard-identity"),a=Object.create(l);m[b.dashboardid]=a;a.initialize(c)});NS.Logger.debug("Mapped dashboards:",
m)}function n(){var c=d(document.body),b=c.width();d(F).on("resize",function(){b=c.width()});d("<iframe />").attr("aria-hidden","true").attr("tabindex","-1").css({width:"100%",height:0,bottom:0,border:0,"background-color":"transparent"}).on("load",function(){var a=null;d(this.contentWindow).on("resize",function(){clearTimeout(a);a=setTimeout(function(){var h=c.width();b!=h&&(c.triggerHandler("resize"),b=h)},100)})}).appendTo(c)}function r(){f=!0;NS.Logger.debug("Dashboard initialization");var c=d("#ns-dashboard-page").data("load-balancer");
NS.Logger.debug("Load balancer initialization, params: ",c);g=NS.DashboardLoadBalancer(c.periodLength,c.maxRequestsPerPeriod,c.maxSimultaneousRequests);NS.Portlet.setPortletLoaderMaker(w);NS.Portlet.setErrorMessageMaker(k);NS.Portlet.setLoadBalancer(g);n();t()}var f=!1,l={},m={},e={},g;l.initialize=function(c){var b=this;this.$root=c;this.allowDragAndDrop=!this.$root.data("dashboard-locked");this.type=this.$root.data("dashboard-type");this.identity=this.$root.data("dashboard-identity");this.plugins=
{};this.portlets={};this.actionHandlers={};this.backend=NS.DashboardBackend(this.$root.data("backend-url"),this.getIdentity());this.readyToLoadDeferred=d.Deferred().done(function(){b.triggerActionOnAllPortlets(NS.Portlet.LOAD_ACTION)});this.makeHeaderOverSelectTooltips();this.initializeSortablePlugin();this.unbindActions();this.mapPlugins();this.mapPortlets();this.bindActions();this.$root.trigger("dashboard-initialized");d(F).on("load",function(){b.readyToLoadDeferred.resolve()});"complete"==document.readyState&&
b.readyToLoadDeferred.resolve()};l.mapPortlets=function(){var c=this;c.portlets={};this.$root.find(".ns-portlet-wrapper").each(function(){var b=d(this).attr("data-portlet-id");c.addPortlet(b,!1)})};l.bindActions=function(){var c=this;this.$root.on("click",".ns-dashboard-action",function(b){b=d(this);var a=b.data("action");NS.Logger.debug("Dashboard action:",a,"clicked");c.triggerAction(a,b.data("action-args"));return!1}).on("dashboard-action",function(b,a){var h=a;b=[];"object"===typeof a&&(h=a.action,
b=a.args);if(a=c.actionHandlers[h])return a.apply(c,[].concat(b)),!1;NS.Logger.warning("No action handler '"+name+"' defined on dashboard ("+c.getId()+")")}).on("portlet-action",function(b,a){c.handleEvent(b,a)}).on("portlet-update",function(b,a){var h=a.portletId;NS.Logger.debug("Handling portlet-update: ",b,a);switch(a.property){case "closed":(b=c.getPortlet(h))&&b.isMaximized()&&c.initializeSortablePlugin();c.layoutUpdate(h,"visibility",{visible:!1}).done(function(){c.$root.trigger("portlet-closed",
a)});g.remove(h);c.portlets[h].finalize();delete c.portlets[h];break;case "maximalize":a.options&&null!=a.options.maximalized&&(!0===a.options.maximalized?c.$root.find(".ns-dashboard-column").sortable("disable"):!1===a.options.maximalized&&c.initializeSortablePlugin(),c.updateMaximized(h,a.property,a.options));break;case "minimized":c.updateMinimized(h,a.property,a.options);g.notify();break;case "placement":c.updatePortletPlacement(h,a.options);g.notify();break;default:c.portletUpdate(h,a.property,
a.options)}}).on("portlet-restart",function(b,a){c.restartPortlet(a.portletId,a)}).on("all-portlets-action",function(b,a){c.triggerActionOnAllPortlets(a.action,a.args,a.logMessage)}).on("insert-portlet",function(b,a){c.insertPortlet(a.portletId,a.column,a.order,a.scriptId,a.deploymentId,a.portletGroup)}).on("inserted-element",function(b,a){g.notify()})};l.unbindActions=function(){this.$root.off()};l.layoutUpdate=function(c,b,a){c=d.extend({portletid:c},a);return this.getBackend().dashboardAction("set-portlet-"+
b,{requestType:"POST"},c).done(function(h){NS.Logger.debug("Dashboard layout "+b+" state persisted to DB"," response: ",h)})};l.portletUpdate=function(c,b,a){return this.getBackend().portletAction(c,"set-portlet-"+b,{requestType:"POST"},a).done(function(h){NS.Logger.debug("Portlet's "+b+" state persisted to DB"," response: ",h)})};l.portletQuery=function(c,b,a){return this.getBackend().dashboardAction(c,"get-portlet-"+b,{},a).done(function(h){NS.Logger.debug("Portlet's "+b+" state reported:"," response: ",
h)})};l.updateMaximized=function(c,b,a){this.getPortlet(c).triggerAction("load")};l.updateMinimized=function(c,b,a){var h=this.getPortlet(c);this.layoutUpdate(c,b,a).done(function(){h.triggerAction("load")})};l.updatePortletPlacement=function(c,b){var a=this,h=a.getPortlet(c),u=h.supportsAction("column_type_change")&&function(){var q=a.$root.find(".ns-dashboard-column"),p=q.eq(b.column-1).data("column-type");q=q.eq(b.originalColumn-1).data("column-type");return p!==q}();c=this.layoutUpdate(c,"placement",
b);u&&(h.switchContentLoaderOn(),c.done(function(){h.triggerAction("column_type_change")}).fail(function(){h.switchContentLoaderOff()}))};l.makeHeaderOverSelectTooltips=function(){0<d(".dashboard-refresh").length&&d("#div__header").addClass("ns-dashboard-refresh__header")};l.initializeSortablePlugin=function(){var c=this;this.$root.find(".ns-dashboard-column").sortable({appendTo:".ns-dashboard-column",connectWith:".ns-dashboard-column",cursor:"move",cursorAt:{top:5},delay:150,disabled:!this.allowDragAndDrop,
distance:5,handle:".ns-portlet-header",opacity:.7,placeholder:"ns-portlet-placeholder",forcePlaceholderSize:!0,scroll:!0,tolerance:"pointer",zIndex:9999,start:function(b,a){a.item.is(".ns-content-manager-item")||(c.$root.trigger("portlet-drag-start",{portletId:a&&a.item?a.item.data("portletId"):null}),c.alignColumnHeight(),c.startPortletDragging(b,a))},stop:function(b,a){a.item.is(".ns-content-manager-item")?c.receiveContentManagerItem(b,a):(c.$root.trigger("portlet-drag-stop"),c.cancelColumnHeightAlignment(),
a.item.hasClass("ns-request-close")?c.dropPortletOnContentManager(a):c.stopPortletDragging(b,a))},receive:function(b,a){b=c.portlets[a&&a.item&&a.item.data?a.item.data("portletId"):null];null!=b&&null!=b.$wrapper&&b.$wrapper.trigger("portlet-column-changed",{newColumnId:this.id,oldColumnId:a.sender&&a.sender[0]&&a.sender[0].id?a.sender[0].id:null})},sort:function(b,a){a.item.is(".ns-content-manager-item")||c.handleNewPlaceholderPosition(a.placeholder)}})};l.alignColumnHeight=function(){var c=this.$root.find(".ns-dashboard-column"),
b=0;c.each(function(){b=Math.max(b,d(this).height())});c.css("min-height",b)};l.cancelColumnHeightAlignment=function(){this.$root.find(".ns-dashboard-column").css("min-height",300)};l.startPortletDragging=function(c,b){c=b.item.parents(".ns-dashboard-column");b.item.data("originalColumn",c.data("column-order"));b.item.data("originalType",c.data("column-type"));b.item.data("originalOrder",b.item.prevAll(".ns-portlet-wrapper").length+1);this.createPortletOriginPlaceholder(b.item)};l.dropPortletOnContentManager=
function(c){var b=this.getPortletOriginPlaceholder(),a=this.$root.find(".ns-dashboard-column").eq(c.item.data("originalColumn")-1);c=c.item.attr("data-portlet-id");a.sortable("cancel");b.remove();this.getPortlet(c).triggerAction("close")};l.receiveContentManagerItem=function(c,b){c=b.item.parents(".ns-dashboard-column");var a=b.item.attr("data-portlet-id"),h=b.item.data("portlet-script-id"),u=b.item.data("portlet-deployment-id"),q=b.item.index(),p=b.item.data("portletGroup");b.item.remove();a||NS.Logger.warning("No portlet id has been received.");
this.$root.trigger("insert-portlet",{portletId:a,column:c.data("column-order"),order:q,scriptId:h,deploymentId:u,portletGroup:p})};l.stopPortletDragging=function(c,b){NS.Logger.debug("Dragged element: ",b.item);c=b.item.parents(".ns-dashboard-column");b.item.removeAttr("style");b.item.trigger("portlet-update",{portletId:b.item.attr("data-portlet-id"),property:"placement",options:{column:c.data("column-order"),order:b.item.prevAll(".ns-portlet-wrapper").length+1,originalColumn:b.item.data("originalColumn"),
originalOrder:b.item.data("originalOrder")}});this.getPortletOriginPlaceholder().remove()};l.createPortletOriginPlaceholder=function(c){var b=d("<div id='ns-portlet-origin-placeholder' />");b.height(c.outerHeight());b.width(c.outerWidth());var a=c.prev();0<a.length?b.insertAfter(a):(c=c.parents(".ns-dashboard-column"),b.prependTo(c));b.droppable({accept:".ns-portlet-wrapper"})};l.getPortletOriginPlaceholder=function(){return d("#ns-portlet-origin-placeholder")};l.handleNewPlaceholderPosition=function(c){var b=
d("#ns-portlet-origin-placeholder"),a=c.next(),h=c.prev().prev();a.is(b)||h.is(b)?c.addClass("ns-portlet-placeholder-minimized"):c.removeClass("ns-portlet-placeholder-minimized")};l.handleEvent=function(c){this.logEvent(c)};l.addPortlet=function(c,b,a){var h=NS.Portlet.create({id:c,dashboardType:this.type,dashboardIdentity:this.identity,restarted:a&&a.restarted,backend:this.getBackend()});jQuery.extend(h,a);c in this.portlets&&(NS.Logger.warning("Portlet",c,"already exists"),this.portlets[c].finalize());
this.portlets[c]=h;NS.Logger.debug("Portlet",c,"added");h.renderLoadedContent(b);return h};l.restartPortlet=function(c,b){this.portlets[c].finalize();delete this.portlets[c];delete b.portletId;b.restarted=!0;b=this.addPortlet(c,!0,b);b.$wrapper.trigger("portlet-restarted",{portletId:c});b.isMaximized()&&(d(F).off("resize.maximize"),d(F).on("resize.maximize",b.maximizeResizeHandler.bind(b)))};l.addPortletLoadingPlaceholder=function(c,b,a){a=d("<div />").addClass("ns-loading-portlet-wrapper").append(w());
c=this.$root.find(".ns-dashboard-column[data-column-order="+c+"]");var h=c.children();b=Math.max(0,Math.min(h.length,b));b===h.length?c.append(a):h.eq(b).before(a);return a};l.insertPortlet=function(c,b,a,h,u,q){function p(I,L){x.layoutUpdate(I,"visibility",L).done(function(){g.load(I,B,function(){return x.getBackend().portletAction(I,"show").done(function(D){B.replaceWith(d(D.wrapper));D=x.addPortlet(I,!0);D.triggerAction(NS.Portlet.LOAD_ACTION);D.$wrapper.trigger("portlet-inserted",{portletId:I,
portletGroup:q})}).fail(function(D,H,G){B.replaceWith(k(H,G))})})}).fail(function(D,H,G){B.replaceWith(k(H,G))})}var x=this,B=x.addPortletLoadingPlaceholder(b,a,c),K={visible:!0,column:b,order:a+1,scriptId:h,deploymentId:u},M=this;h!=C&&u!=C?x.getBackend().dashboardAction("get-first-free-dashboard-app-portlet-id",{requestType:"POST"},K).done(function(I){I.portletId&&(p(I.portletId,K),K.id=I.portletId,K.portletGroup=q,M.$root.trigger("bind-content-manager-item",K))}):p(c,K)};l.getIdentity=function(){return this.identity};
l.getBackend=function(){return this.backend};l.getId=function(){return this.identity.dashboardid};l.getType=function(){return this.type};l.getPortlet=function(c){return this.portlets[c]};l.getPortletIds=function(){return Object.keys(this.portlets)};l.getPortletsCount=function(){return Object.keys(this.portlets).length};l.logEvent=function(c){NS.Logger.debug("Event: ",c)};l.triggerActionOnAllPortlets=function(c,b,a){for(var h in this.portlets){var u=this.portlets[h];u.supportsAction(c)&&(a&&NS.Logger.debug(a.replace(/%p/g,
h).replace(/%a/g,c)),u.triggerAction(c,b))}};l.mapPlugins=function(){var c=this;c.plugins={};this.$root.find(".ns-dashboard-plugin").each(function(){var b=d(this),a=b.data("plugin-name");a&&e[a]&&(c.plugins[a]={plugin:e[a](c,b),container:b})})};l.triggerAction=function(c,b){this.$root.trigger("dashboard-action",b?{action:c,args:b}:c)};l.registerActionHandler=function(c,b,a){this.actionHandlers[c]=a?b.bind(a):b};d(function(){f||r()});return{registerPlugin:function(c,b){e[c]=b},getDashboard:function(c){return m[c]},
getPortlet:function(c,b){var a;if(b)return(a=m[b])&&a.getPortlet(c);for(b in m)if(a=m[b],a=a.getPortlet(c))return a;return C},getInstance:function(){f||r();var c=Object.keys(m);return m[c[0]]},makePortletLoader:w}}(this,NS.jQuery);(function(F,d,C){NS.Dashboard.registerPlugin("ColumnLayoutManager",function(w,k){function t(l){return w.getBackend().pluginAction("column-layout-manager","setLayout",{},{layout:l})}var n=d("#ns-dashboard-layout-plugin"),r;n.attr("aria-haspopup","true");n.attr("aria-controls","nsDashboardColumnLayoutManagerContent");n.attr("aria-expanded","false");n.click(function(){d(this).trigger("dashboard-action","toggleColumnLayoutManager");return!1});k.on("mousemove",function(){clearTimeout(r)});k.on("mouseout",
function(){clearTimeout(r);r=setTimeout(function(){k.hide();n.attr("aria-expanded","false")},100)});var f={changeColumnLayout:function(l){t(l).done(function(){F.location.reload(!1)})},toggle:function(){NS.Logger.debug("Layout manager toggled.");k.css({right:d(F).width()-n.position().left-n.outerWidth()+"px",top:n.position().top+n.height()+5+"px"});n.attr("aria-expanded","none"===k.css("display"));k.slideToggle(100)}};w.registerActionHandler("toggleColumnLayoutManager",f.toggle,f);w.registerActionHandler("changeColumnLayout",
f.changeColumnLayout,f);return f})})(this,NS.jQuery);(function(F,d,C){NS.Dashboard.registerPlugin("ContentManager",function(w,k){function t(z){var v=z.id,y=z.portletGroup,A=z.groupElement,J=z.portlet,E=J&&J.instance&&J.instance.$portletElement?J.instance.$portletElement:A,P=function(){var O;y&&d.isArray(y.items)&&(O=y.items.filter(function(W){return!1===W.used})[0]);return O};return{getId:function(){return v},getFirstUnusedPortletId:function(){return P()},getPortlet:function(){return w.getPortlet(v)},getLabel:function(){return this.getPortlet().getInstanceInfo().label},
getTooltipText:function(){return this.getPortlet().getInstanceInfo().tooltipText},getScriptId:function(){return y.scriptId},getDeploymentId:function(){return y.deploymentId},getColumnPreference:function(){return y.columnPreference},updateTitle:function(){d(".ns-current-title",E).text(this.getLabel())},isEnabled:function(){return!E.hasClass("ns-disabled-item")},isCloseable:function(){return E.hasClass("ns-close-supported")},isUsed:function(){return E.hasClass("ns-currently-used")},isPending:function(){return E.hasClass("ns-initializing")},
isAvailable:function(){return!this.isUsed()&&!this.isPending()},updatePortletsCount:function(){d(".ns-portlet-counter",A).text(0<y.count?y.count:"");A.toggleClass("ns-disabled-item",1>y.count);y&&y.$tooltipElement&&(y.$tooltipElement.find(".ns-portlets-remaining .ns-tooltip-count-number").text(y.count),1>y.count&&y.$tooltipElement.addClass("ns-disabled-item"))},moveToPending:function(){E.addClass("ns-initializing")},updateSupportedActions:function(){var O=!0===y.isDashboardApp?!0:this.getPortlet().supportsAction("close"),
W=E.find(".ns-button-container i");E.toggleClass("ns-close-supported",O).toggleClass("ns-locked-cannot-be-removed",!O);W.toggleClass("ns-remove-portlet",O);var ba=!0===y.isDashboardApp?y.description:this.getPortlet().getTitle();O&&E.attr("aria-label",(NS.Translations.dictionary["NLButtonContext.REMOVE"]||"Remove")+" "+ba);!O&&E.hasClass("ns-currently-used")&&(W.addClass("ns-locked-portlet"),E.attr("aria-label",ba+" - "+(NS.Translations.dictionary["NLPagemessageContext.LOCKED"]||"Locked")))},moveToUsed:function(){J.instance.used=
!0;J.instance.$portletElement=A.clone();E=J.instance.$portletElement;E.attr({id:"portlet-"+J.instance.id,"data-portlets-count":null,"data-portlet-id":J.instance.id}).removeClass("ns-initializing").removeClass("ns-disabled-item").removeClass("ns-content-manager-item-active").addClass("ns-currently-used");A.removeClass("ns-initializing");y.count--;this.updatePortletsCount();d(".ns-portlet-counter",E).text("");y.isDashboardApp?d(".ns-current-title",E).text(y.description):this.updateTitle();da.$contentElement.append(E);
u();this.updateSupportedActions()},moveToAvailable:function(){J.instance.used=!1;y.$referenceElement.attr("data-portlet-id",null);y.count++;this.updatePortletsCount();E.remove();u()},insert:function(){var O=P();if(!O)return NS.Logger.warning("Portlet of the group: "+y.originalType+" cannot be added. There are no free slots available. This should not happen."),!1;v=O.id;if(this.isAvailable()){this.moveToPending();O=w.$root;var W=O.trigger,ba=v,fa=this.getScriptId(),ha=this.getDeploymentId();var X=
this.getColumnPreference();X=Y.filter("[data-column-type="+X+"]");X=0<X.length?X.eq(0):Y.eq(0);W.call(O,"insert-portlet",{portletId:ba,scriptId:fa,deploymentId:ha,column:X.data("column-order"),order:0,portletGroup:y})}},close:function(){this.isUsed()&&this.isCloseable()&&this.getPortlet().triggerAction("close")}}}function n(){w.getBackend().pluginAction("content-manager","get-available-portlets").done(function(z){r(z);m();I()})}function r(z){R=z.portletData.groups;R.forEach(function(v,y){U[y]="DASHBOARD_APPS"===
v.type?l(z.portletData.scripts,y):v.items&&v.items.length?f(v.items,y):{};"CURRENTLY_USED"===v.type&&(da=v)})}function f(z,v){var y={};z.forEach(function(A){Q[A.id]={instance:A,categoryIndex:v};var J=btoa(encode(A.typeName+"_"+A.description));y[J]=y[J]||{originalType:A.typeName,type:J,count:0,items:[],description:A.description,help:A.help,columnPreference:A.columnPreference.toLowerCase()};A.originalTypeName=A.typeName;A.typeName=J;y[J].items.push(A);y[J].count++});return y}function l(z,v){var y={};
z&&z.forEach(function(A){var J=A.type+"_"+A.scriptId+"_"+A.deploymentId,E={typeName:J,scriptId:A.scriptId,deploymentId:A.deploymentId,iconId:A.icon,iconUrl:A.iconUrl,description:A.title,columnPreference:"wide",used:!1};y[J]={id:null,columnPreference:"wide",scriptId:A.scriptId,deploymentId:A.deploymentId,iconId:A.icon,iconUrl:A.iconUrl,description:A.title,type:J,originalType:A.type,count:1,items:[E],isDashboardApp:!0};Q[J]={instance:E,categoryIndex:v}});return y}function m(z){e();g();c();w.getPortletIds().map(function(v){Q[v]&&
x(v).perform(function(){this.moveToUsed()})});w.getBackend().dashboardAction("get-used-dash-apps",{requestType:"GET"},{}).done(function(v){for(var y in v.dashAppSlots){if(!v.dashAppSlots.hasOwnProperty(y))return!1;var A=d("[data-portlet-script-id='"+v.dashAppSlots[y].scriptId+"'][data-portlet-deployment-id='"+v.dashAppSlots[y].deploymentId+"']",S);A.attr("data-portlet-id",y);Q[y]=Q[A.data("personalizePortletType")];Q[y].instance.id=y;x(y).perform(function(){this.moveToUsed()})}});a(V);k.find(".ns-content-selection").toggle(!0);
k.find(".ns-personalize-loading").toggle(!1)}function e(){var z=Z.find("ul"),v;z.empty();R.map(function(y,A){v=d("<li />").text(y.title).addClass("ns-group");v.attr("id","group"+A);v.data("index",A);v.data("type",y.type);v.click(function(){a(A)});z.append(v);y.$linkElement=v;y.$contentElement=q(".ns-content-manager-category-content").clone().attr("data-category-index",A);T.append(y.$contentElement);y.$contentElement.tooltip({items:".ns-content-manager-item",content:b,show:{effect:"fadeIn",delay:800},
track:!0,tooltipClass:"ns-content-manager-tooltip-wrapper",position:{my:"left-15 top+20"}})});a(V);da.$contentElement.addClass("ns-currently-used")}function g(){U.forEach(function(z,v){var y=R[v].$contentElement;Object.keys(z).forEach(function(A){A=z[A];if(A.items&&0<A.items.length){var J=y.append,E=q(".ns-content-manager-item").clone();U[v][A.type].$referenceElement=E;E.attr({id:"portlet-group-"+A.type,"class":"ns-content-manager-item","data-group-index":v,"data-portlets-count":A.count,"data-portlet-type":A.originalType,
"data-personalize-portlet-type":A.type,"data-column-preference":A.columnPreference.toLowerCase(),"data-portlet-script-id":A.items[0].scriptId,"data-portlet-deployment-id":A.items[0].deploymentId});E.data("portletGroup",A);A.items[0].automationMeta&&E.attr("data-automation",JSON.stringify(A.items[0].automationMeta));E.find(".ns-default-title").text(A.description);A.count&&0<A.count&&E.find(".ns-portlet-counter").text(A.count);E.attr("aria-label",(NS.Translations.dictionary["NLButtonContext.ADD"]||
"Add")+" "+A.description);var P=E.find(".ns-portlet-thumbnail");A.iconUrl&&P.css({"background-image":"url("+A.iconUrl+")","background-position":"center center","background-size":"contain","background-repeat":"none"});J.call(y,E)}});y.children().draggable({appendTo:document.body,helper:"clone",connectToSortable:".ns-dashboard-column",cursor:"move",opacity:.7,zIndex:5E3,cancel:".ns-currently-used, .ns-disabled-item",start:function(A,J){var E=d(A.currentTarget);A=U[E.attr("data-group-index")][E.attr("data-personalize-portlet-type")];
E=new t({portletGroup:A,groupElement:E});var P=E.getFirstUnusedPortletId();E&&P&&(J.helper.attr("data-portlet-id",P.id),J.helper.data("portletGroup",A))}})})}function c(){var z=R.filter(function(y){return"DASHBOARD_APPS"===y.type})[0];if(z){var v=z.$linkElement;w.getBackend().dashboardAction("get-dash-apps-info",{requestType:"GET"},{}).done(function(y){var A=y.info.freeSlots.length;y=Object.getOwnPropertyNames(y.info.dashAppSlots).length;var J=T.find("[data-group-index="+v.data("index")+"]:not(.ns-currently-used)");
ia.toggleClass("ns-content-hidden",!!A);ja.toggleClass("ns-content-hidden",!(!J.length&&!y)||!A);ka.text(y+"/"+(A+y));J.each(function(){var E=d(this),P=E.data("portletGroup");E.toggleClass("ns-disabled-item",!A||1>P.count);E.attr("aria-disabled",!A)})})}}function b(){var z=d(this),v=z.data("personalizePortletType"),y=U[z.data("groupIndex")][v],A=!(!z.data("portletId")||!z.hasClass("ns-currently-used")),J=A&&z.hasClass("ns-close-supported"),E=q(".ns-content-manager-portlet-tooltip").clone(),P=y.description||
z.find(".ns-default-title").text();E.attr("data-portlet-type",v);E.toggleClass("ns-currently-used",A);E.toggleClass("ns-close-supported",J);E.toggleClass("ns-disabled-item",z.hasClass("ns-disabled-item"));E.find(".ns-content-manager-portlet-title").text(P);P!==y.help&&E.find(".ns-tooltip-body > .ns-portlet-description").text(y.help||"");d(this).find(".ns-portlet-thumbnail");E.find(".ns-portlet-thumbnail");A||(E.find(".ns-portlets-remaining .ns-tooltip-count-message").text(P+" "+(NS.Translations.dictionary["NLPageMessage.PORTLETS_LEFT"]||
"portlets remaining:")),E.find(".ns-portlets-remaining .ns-tooltip-count-number").text(y.count));z=d(this).find(".ns-portlet-thumbnail");E.find(".ns-portlet-thumbnail").css({"background-image":z.css("background-image"),"background-position":z.css("background-position"),"background-repeat":z.css("background-repeat"),"background-size":z.css("background-size")});return y.$tooltipElement=E}function a(z){var v=R[z].$linkElement,y=R[z].$contentElement;V=z;ca=v;v.addClass("ns-active-group").siblings().removeClass("ns-active-group");
d(".ns-content-manager-category-content").hide();y.show();T.css({left:"0"});h();z=k.find(".ns-content-message .ns-content-dashboard-apps");switch(R[V].type){case "DASHBOARD_APPS":z.removeClass("ns-content-hidden");break;default:z.addClass("ns-content-hidden")}u()}function h(){k.attr("aria-activedescendant",(N?N:ca).attr("id"))}function u(){var z=R[V].$contentElement.children(".ns-content-manager-item:not(.ns-content-hidden)"),v=z.length;0<v&&null===ea&&(ea=z[0].offsetWidth+16);T.width(Math.ceil(v/
2)*(ea??0))}function q(z){return d(".ns-content-manager-templates").children(z)}function p(z){var v=S.find(".ns-movable-content-wrapper"),y=v.scrollLeft(),A=T.width()-v.width();v.scrollLeft(Math.min(Math.max(y+z,0),A))}function x(z){var v=Q[z],y=U[v.categoryIndex][v.instance.typeName],A=y.$referenceElement;return{perform:function(J){y?J.apply(new t({id:z,portletGroup:y,groupElement:A,portlet:v})):NS.Logger.warning("Portlet with id: "+z+" is not registered in the content manager")}}}function B(z,v){N&&
N.removeClass("ns-content-manager-item-active");z&&z.length?(N=z,N.addClass("ns-content-manager-item-active"),z.get(0).scrollIntoView({block:"nearest"})):N=null;h()}function K(z){var v=M(V),y=v.index(N);switch(z){case NS.UI.Constants.KeyCode.ARROW_DOWN:y=Math.ceil(y+v.length/2);y<v.length&&B(v.eq(y));break;case NS.UI.Constants.KeyCode.ARROW_UP:y=Math.floor(y-v.length/2);0<=y&&B(v.eq(y));break;case NS.UI.Constants.KeyCode.ARROW_RIGHT:v.length>y+1&&y+1!==Math.ceil(v.length/2)&&B(v.eq(y+1),1);break;
case NS.UI.Constants.KeyCode.ARROW_LEFT:0<y&&y!==Math.ceil(v.length/2)?B(v.eq(y-1),-1):B(null);break;case NS.UI.Constants.KeyCode.ENTER:N.hasClass("ns-currently-used ns-close-supported")?(z=N.data("portletId"),x(z).perform(function(){this.close()}),v=M(V),B(v.eq(y>=v.length?v.length-1:y))):N.hasClass("ns-currently-used")||(y=U[N.data("groupIndex")][N.data("personalizePortletType")],y=new t({portletGroup:y,groupElement:N}),y.isEnabled()&&y.insert());break;case NS.UI.Constants.KeyCode.ESCAPE:B(null);
break;default:return!0}return!1}function M(z){return R[z].$contentElement.find(".ns-content-manager-item:not(.ns-content-hidden)")}function I(){w.$root.on("portlet-inserted",function(z,v){x(v.portletGroup&&!0===v.portletGroup.isDashboardApp?v.portletGroup.type:v.portletId).perform(function(){this.moveToUsed()});u();c()}).on("portlet-restarted",function(z,v){x(v.portletId).perform(function(){this.updateSupportedActions();this.updateTitle()})}).on("portlet-update",function(z,v){"closed"===v.property&&
x(v.portletId).perform(function(){this.moveToAvailable()})}).on("portlet-closed",function(){c()}).on("portlet-drag-start",function(z,v){z=d(".ns-remove-portlet-drop-target");v&&v.portletId&&Q[v.portletId]&&Q[v.portletId].instance&&z.toggleClass("ns-portlet-cannot-be-removed",!Q[v.portletId].instance.$portletElement.is(".ns-close-supported"));z.fadeIn()}).on("portlet-drag-stop",function(){d(".ns-remove-portlet-drop-target").fadeOut().removeClass("ns-portlet-cannot-be-removed")}).on("portlet-title-update",
function(z,v){x(v.portletId).perform(function(){this.updateTitle()})}).on("bind-content-manager-item",function(z,v){d("[data-portlet-script-id='"+v.scriptId+"'][data-portlet-deployment-id='"+v.deploymentId+"']").attr("data-portlet-id",v.id);Q[v.id]=Q[v.portletGroup.type];Q[v.id].instance.id=v.id})}var L=!1,D=!1,H=d.Deferred(),G=d("#ns-dashboard-personalize-link"),Z=k.find(".ns-group-selection"),S=k.find(".ns-portlet-selection"),T=S.find(".ns-movable-content"),Y=w.$root.find("#ns-dashboard-content").children(".ns-dashboard-column"),
ka=k.find(".ns-content-apps-counter-state"),ia=k.find(".ns-content-apps-reach-limit"),ja=k.find(".ns-content-no-apps"),ca=null,N=null,ea=null,R,U=[],Q=[],V=0,da=null;var aa={loadData:function(){D||(n(),D=!0)},insertPortlet:function(z){d.when(H).then(function(){x(z).perform(function(){this.insert()})})},closePortlet:function(z){d.when(H).then(function(){x(z).perform(function(){this.close()})})},toggle:function(){this.loadData();k.slideToggle();k.focus();if(L=!L){var z=d("#pageContainer>#body"),v=z.scrollTop();
k.position().top<v&&z.animate({scrollTop:k.position().top-30},500)}G.attr("aria-expanded",L)}};(function(){var z=NS.UI.Util.isRedwood?226:200;k.on("click","button.ns-close-content-manager",function(){aa.toggle()}).on("click","button.ns-prev-portlet-selection-page",function(){p(-z)}).on("click","button.ns-next-portlet-selection-page",function(){p(z)}).on("mouseenter",".ns-content-manager-item.ns-currently-used",function(){w.getPortlet(d(this).attr("data-portlet-id")).highlight(!0)}).on("mouseleave",
".ns-content-manager-item.ns-currently-used",function(){w.getPortlet(d(this).attr("data-portlet-id")).highlight(!1)}).on("click",".ns-content-manager-item:not(.ns-currently-used)",function(v){v=d(v.currentTarget);var y=U[v.data("groupIndex")][v.data("personalizePortletType")];v=new t({portletGroup:y,groupElement:v});v.isEnabled()&&v.insert()}).on("click",".ns-content-manager-item.ns-currently-used.ns-close-supported",function(v){v=d(v.currentTarget).data("portletId");x(v).perform(function(){this.close()})}).on("keydown",
function(v){if(null===N)b:{switch(v.keyCode){case NS.UI.Constants.KeyCode.ARROW_DOWN:v=ca.next();0<v.length&&a(v.data("index"));break;case NS.UI.Constants.KeyCode.ARROW_UP:v=ca.prev();0<v.length&&a(v.data("index"));break;case NS.UI.Constants.KeyCode.ENTER:case NS.UI.Constants.KeyCode.ARROW_RIGHT:B(M(V).first());break;case NS.UI.Constants.KeyCode.ESCAPE:aa.toggle();break;default:v=!0;break b}v=!1}else v=K(v.keyCode);return v});S.find(".ns-remove-portlet-drop-target").droppable({accept:".ns-portlet-wrapper",
tolerance:"pointer",hoverClass:"ns-highlight",drop:function(v,y){y.draggable.addClass("ns-request-close")}});G.attr("aria-controls","nsDashboardContentManagerContent");G.attr("aria-expanded","false");G.click(function(){d(this).trigger("dashboard-action","toggleContentManager");return!1});NS.UI.Helpers.Accessibility.doClickOnSpaceKey(G)})();w.registerActionHandler("toggleContentManager",aa.toggle,aa);return aa})})(this,NS.jQuery);(function(F,d){NS.Dashboard.registerPlugin("EmployeeCenterPlugin",function(C,w){function k(l,m){var e=d.Deferred(),g=function(a){a.status&&"ok"===a.status?e.resolve(a):c(a)},c=function(a){e.reject(a)},b=C.getBackend();b.onFail(c);b.onDone(function(){b.pluginAction("employee-center-plugin",l,{},m).done(g).fail(c)});return e}function t(l,m){(new NS.UI.Messaging.Message({message:NS.Translations.dictionary[l],type:m})).show()}function n(l){w.find("button").prop("disabled",l)}function r(){w.find(".publish-btn").toggleClass("publish-btn--loading")}
w.find("button[data-action]").click(function(){var l=d(this).data("action");C.triggerAction(l)});var f={publish:function(){n(!0);r();k("publish").done(function(l){NS.Logger.debug("Shared dashboard published.");F.location.href=l.redirectUrl}).fail(function(){NS.Logger.error("Shared dashboard publishing failed.");t("NLErrormessageContext.DASHBOARD_SERVER_ERROR_UNABLE_TO_PUBLISH",NS.UI.Messaging.Type.ERROR);n(!1);r()})},cancel:function(){F.confirm(NS.Translations.dictionary["NLPagemessageContext.DASHBOARD_DISCARD_CURRENT_CHANGES"])&&
(n(!0),k("cancel").done(function(){F.location.href=w.data("viewUrl")}).fail(function(){NS.Logger.error("Shared dashboard reset failed.");t("NLErrormessageContext.DASHBOARD_SERVER_ERROR_UNABLE_TO_RESET",NS.UI.Messaging.Type.ERROR);n(!1)}))}};C.registerActionHandler("publishSharedDashboard",f.publish,f);C.registerActionHandler("cancelSharedDashboard",f.cancel,f);return f})})(this,NS.jQuery);(function(F,d,C){NS.DashboardLoadBalancer=function(w,k,t){function n(g){m++;setTimeout(function(){m--;r()},w);e++;g.load().always(function(){e--;r()})}function r(){var g=Math.min(k-m,t-e);var c=[];for(u in l){if(0===g)break;var b=l[u];var a=b.$element;b=0+d("#pageContainer>#body").height();var h=a.position().top;a=h+a.height();h<b&&0<a&&(c.push(u),g--)}for(g=0;g<c.length;g++){var u=c[g];b=l[u];delete l[u];n(b)}}function f(){0<Object.keys(l).length&&r()}var l={},m=0,e=0;d(F).on("resize",f);d("#pageContainer>#body").on("scroll",
f);return{load:function(g,c,b){l[g]={$element:c,load:b};r()},notify:function(){r()},remove:function(g){delete l[g]}}}})(this,NS.jQuery);NS.Logger=function(F,d,C){d=NS.Logger&&NS.Logger.debugValue;var w=function(){return this};C=function(k){return function(){var t=console.log;Function.prototype.bind&&F.console&&"object"==typeof t&&(t=Function.prototype.bind.call(console.log,console));t.apply(console,[k].concat(Array.prototype.slice.call(arguments)));return this}};w={debug:w,info:w,warning:w,error:w};console&&(d?(w.debug=C("Debug:"),w.info=C("Info:"),w.warning=C("Warning:"),w.error=C("Error:")):w.error=C("Unexpected application error:"));
return w}(this,NS.jQuery);NS.Portlet=function(F,d,C){function w(a){var h={};a.find(".ns-portlet-data").each(function(){var u=d(this),q=u.data("name");u=u.data("value");q&&(h[q]=u)});return h}function k(a,h){d(h).find(".ns-portlet-action").each(function(){var u=d(this),q=u.data("action"),p=u.data("action-args");if(q=a.actions[q])"object"===typeof q?(p=[].concat(q.args,p),q=q.name):p=[].concat(p),"openWindow"==q&&(q=u.html(),u.empty(),d("<a>").attr({href:p[0],target:p[1]}).html(q).appendTo(u))});d(h).find(".ns-portlet-action-select").each(function(){var u=
d(this),q=u.data("action"),p=u.data("action-args");u=u.find("input.nldropdown");u.data("action",q);u.data("action-args",p);u.addClass("ns-portlet-action-dropdown")})}function t(a,h,u){"function"==typeof a[h]?(NS.Logger.debug("Portlet method '"+h+"' called (for "+a.id+")"),a[h].apply(a,u)):NS.Logger.warning("No method '"+h+"' defined on portlet ("+a.id+")")}function n(a,h){function u(D,H,G,Z){D.hasClass("ns-portlet-action-menu-item")||(D.hasClass("ns-portlet-action-submenu-expanded")&&p(D),0<G?(H=
K(D,H,1),B(D,H)):(H=K(D,H,-1),B(D,H)));NS.UI.Helpers.preventDefault(Z)}function q(D){D.addClass("ns-portlet-action-submenu-expanded");D.attr("aria-expanded","true")}function p(D){D.removeClass("ns-portlet-action-submenu-expanded");D.attr("aria-expanded","false")}function x(D){return D.parents(".ns-portlet-action-submenu")}function B(D,H){H.length&&(D&&D.removeClass("ns-portlet-action-selected"),H.addClass("ns-portlet-action-selected"));D&&D.removeClass("ns-portlet-action-selected");H.length?I.attr("aria-activedescendant",
H.attr("id")):I.attr("aria-activedescendant",L.length?L.attr("id"):"")}function K(D,H,G){for(D=D&&D.length?0<G?D.next():D.prev():0<G?H.children().first():H.children().last();D.length&&!D.hasClass("ns-portlet-action")&&!D.hasClass("ns-portlet-action-submenu");)D=0<G?D.next():D.prev();return D}function M(){I.find(".ns-portlet-action-submenu").each(function(){p(d(this))});I.find(".ns-portlet-action-selected").each(function(){d(this).removeClass("ns-portlet-action-selected").removeClass("ns-portlet-action-submenu-expanded")});
I.removeAttr("aria-activedescendant")}var I=h.find(".ns-portlet-header"),L=I.find(".ns-portlet-help-minimize");I.on("focus",function(D){r||(I.addClass("ns-portlet-active"),L.length&&I.attr("aria-activedescendant",L.attr("id")))});I.on("mousedown",function(D){r=!0});I.on("mouseup",function(D){r=!1});I.on("blur",function(){I.removeClass("ns-portlet-active");I.removeAttr("aria-activedescendant");M()});I.on("keydown",function(D){var H=I.find(".ns-portlet-controls"),G=H.find(".ns-portlet-action-selected").last();
switch(D.keyCode){case NS.UI.Constants.KeyCode.ENTER:case NS.UI.Constants.KeyCode.SPACE:G.hasClass("ns-portlet-action-submenu")?q(G):G.length?G.click():a.supportsAction("minimize")&&a.triggerAction("minimize");NS.UI.Helpers.preventDefault(D);break;case NS.UI.Constants.KeyCode.ARROW_RIGHT:u(G,H,1,D);break;case NS.UI.Constants.KeyCode.ARROW_LEFT:u(G,H,-1,D);break;case NS.UI.Constants.KeyCode.ARROW_DOWN:G.hasClass("ns-portlet-action-submenu")?(G.hasClass("ns-portlet-action-submenu-expanded")||q(G),G=
G.find("ul"),G=K(C,G,1),B(C,G)):G.hasClass("ns-portlet-action-menu-item")&&(H=K(G,x(G).find("ul"),1),H.length&&B(G,H));NS.UI.Helpers.preventDefault(D);break;case NS.UI.Constants.KeyCode.ARROW_UP:G.hasClass("ns-portlet-action-menu-item")&&(H=K(G,x(G).find("ul"),-1),H.length?B(G,H):B(G,x(G)));NS.UI.Helpers.preventDefault(D);break;case NS.UI.Constants.KeyCode.ESCAPE:a.isMaximized()&&a.maximize(),M()}})}var r=!1,f=null,l={CSS_PORTLET_MAXIMALIZED_MODE:"ns-portlet-window-state-maximalized",CSS_PORTLET_MINIMALIZED_MODE:"ns-portlet-window-state-minimized",
CSS_PORTLET_NORMAL_MODE:"ns-portlet-window-state-normal"},m={className:"Portlet"},e=function(){return d()},g=function(){return d()},c={};m.initialize=function(){var a=this,h=this.$wrapper;this.$content.find("script").remove();this.data=w(this.$content);this.$title=this.$wrapper.find(".ns-portlet-header-text");this.actions=this.$wrapper.data("portlet-actions");this.origColumnType=this.$wrapper.parent().data("columnType");h.add(this.$title).off();k(a,h);n(a,h);h.on("inserted-element",function(q){k(a,
q.target)}).on("click",".ns-portlet-action",function(q){q=d(this);var p=q.data("action");NS.Logger.debug("Portlet action:",p,"clicked");a.triggerAction(p,q.data("action-args"));return!1}).on("dropdownChange",".ns-portlet-action-dropdown",function(q){var p=d(this);q=p.data("action");p=p.data("action-args");NS.Logger.debug("Portlet select action:",q,", selected:",this.value);a.triggerAction(q,p?[].concat(p,this.value):this.value);return!1});this.$wrapper.on("portlet-action",function(q,p){q=p;var x=
[];"object"===typeof p&&(q=p.action,x=p.args);if(p=a.actions[q])return NS.Logger.debug("Portlet action:",q,"accepted, call =",p),"object"===typeof p?t(a,p.name,[].concat(p.args,x)):t(a,p,[].concat(x)),!1;NS.Logger.debug("Unsupported portlet action:",q)}).on("portlet-setup-completed",function(q){a.reload("setupCompleted");NS.Logger.debug("portlet-setup-completed")}).on("portlet-setup-updating",function(q,p){a.indicateSetupUpdate(p);NS.Logger.debug("portlet-setup-updating")}).on("portlet-column-changed",
function(q,p){a.columnChanged(p)});var u=this;this.$title.on("mousedown",function(q){u.$title.one("mouseup",function(p){var x=p.screenX-q.screenX,B=p.screenY-q.screenY;p=p.which;a.$wrapper.is(".ui-sortable-helper")||0!==x||0!==B||1!==p||a.triggerAction("minimize")})});this.$wrapper.trigger("portlet-initialized",{portletId:this.id})};m.finalize=function(){NS.Logger.debug("Portlet finalized:",this)};m.supportsAction=function(a){return!!this.actions[a]};m.triggerAction=function(a,h){this.$content.trigger("portlet-action",
h?{action:a,args:h}:a)};m.triggerActionOnAllPortlets=function(a,h,u){this.$wrapper.trigger("all-portlets-action",{action:a,args:h,logMessage:u})};m.triggerEvent=function(a,h){this.$content.trigger(a,h)};m.openWindow=function(a,h,u,q){F.open(a,h,u,q)};m.openPopup=function(a,h,u,q,p,x,B){nlExtOpenWindow(a,h,u,q,this.$wrapper.get(0),!0,p,x,B)};m.setup=function(a,h,u,q,p){NS.Logger.debug("Portlet SETUP activated (for "+this.id+")",a,h,u,q,p);a&&this.openPopup(a,h+"_setupDialog",u,q,p)};m.indicateSetupUpdate=
function(a){a=NS.Window.getActive();if(a){var h=NS.Translations.dictionary["NLPagemessageContext.UPDATING_PORTLET_SETUP"]||"Updating Portlet Setup ...";var u=NS.LoadMask.create({text:h,target:a.element});u.show();d(a.element).find("iframe").one("load",function(){u.hide()})}};m.postReload=function(a,h){this.reload(a,h,{requestType:"POST"})};m.reload=function(a,h,u){var q=this;"object"==typeof h?d.extend(h,{maximized:this.isMaximized()}):h="maximized="+(this.isMaximized()?"T":"F")+(h&&0<h.length?"&"+
h:"");"columnTypeChange"!==a&&this.isLoading()?this.updateLoaderMessage():(NS.Logger.debug("Portlet RELOAD activated (for "+this.id+")",a),c.load(this.getId(),this.$wrapper,function(){NS.Logger.debug("Refreshing portlet: "+q.getId());return q.requestContent(a,h,u)}))};m.load=function(){var a=this;this.isMinimized()||(NS.Logger.debug("Portlet LOAD activated (for "+this.id+")"),c.load(this.getId(),this.$wrapper,function(){NS.Logger.debug("Loading portlet: "+a.getId());return a.requestContent("load")}))};
m.getCurrentWrapperLayoutClass=function(a){var h=null;a=a?a.classList:this.$wrapper[0].classList;for(var u in l)l.hasOwnProperty(u)&&a.contains(l[u])&&(h=l[u]);return h};m.switchWrapperLayoutClasses=function(a){a:{for(h in l)if(l.hasOwnProperty(h)&&l[h]===a){var h=!0;break a}h=!1}h&&(this.previousWrapperLayoutClass=this.getCurrentWrapperLayoutClass(),this.previousWrapperLayoutClass!==a&&(this.$wrapper.removeClass(this.previousWrapperLayoutClass),this.$wrapper.addClass(a)))};m.toggleMaximalizeBackground=
function(){var a=d(".ns-portlet-maximized-mode-background");a&&0<a.length?a.remove():d('<div class="ns-portlet-maximized-mode-background"></div>').insertBefore(this.$wrapper)};m.maximizeResizeHandler=function(){null!==f&&clearTimeout(f);f=setTimeout(function(){f=null;var a=this.$wrapper.height()-this.$wrapper.find(".ns-portlet-header").outerHeight(!0);this.$body.outerHeight(a);this.$wrapper.trigger("maximize.bodyHeightChanged",{newBodyHeight:a})}.bind(this),100)};m.maximize=function(){if(!this.isLoading()){var a=
this.$wrapper.find(".ns-portlet-icon-maximize.ns-portlet-action.ns-portlet-icon"),h=NS.Translations.dictionary["NLButtonContext.MAXIMIZE"]||"Maximize";this.isMaximized()?(this.$body.outerHeight("auto"),this.switchWrapperLayoutClasses(l.CSS_PORTLET_NORMAL_MODE),d("body").removeClass("ns-body__portlet-maximized"),"narrow"===this.origColumnType&&this.$wrapper.parent().attr("data-column-type","narrow"),d(F).off("resize.maximize")):(this.switchWrapperLayoutClasses(l.CSS_PORTLET_MAXIMALIZED_MODE),h=NS.Translations.dictionary["NLButtonContext.RESTORE"]||
"Restore",this.origColumnType=this.$wrapper.parent().data("columnType"),d("body").addClass("ns-body__portlet-maximized"),"narrow"===this.origColumnType&&this.$wrapper.parent().attr("data-column-type","wide"),d(F).on("resize.maximize",this.maximizeResizeHandler.bind(this)));this.toggleMaximalizeBackground();a&&1===a.length&&(a=a[0],a.setAttribute("aria-label",h),a.setAttribute("title",h));this.triggerEvent("maximized-change",{maximized:this.isMaximized()});this.triggerUpdate("maximalize",{maximalized:this.isMaximized()})}};
m.minimize=function(){this.isMinimized()?(this.switchWrapperLayoutClasses(l.CSS_PORTLET_NORMAL_MODE),this.triggerEvent("minimized-turned-off")):this.isMaximized()||this.switchWrapperLayoutClasses(l.CSS_PORTLET_MINIMALIZED_MODE);this.$wrapper.find(".ns-portlet-help-minimize").attr("aria-expanded",!this.isMinimized());this.triggerUpdate("minimized",{minimized:this.isMinimized()})};m.columnChanged=function(a){};m.close=function(){var a=this;a.supportsAction("close")&&(this.isMaximized()&&(this.toggleMaximalizeBackground(),
d("body").removeClass("ns-body__portlet-maximized"),"narrow"===this.origColumnType&&this.$wrapper.parent().attr("data-column-type","narrow")),this.triggerUpdate("closed"),this.$wrapper.slideUp(400,function(){a.$wrapper.remove();c.notify()}))};m.setTitle=function(a){this.$title.text(a);this.$title.trigger("portlet-title-update",{portletId:this.id})};m.getTitle=function(){return this.$title.text()};m.setContent=function(a){var h=this.$content;h.html(a);h.find("script").remove();this.data=w(h);this.renderLoadedContent(!0);
this.switchContentLoaderOff()};m.renderLoadedContent=function(a){var h=this.$body.find(".ns-portlet-loader");this.$loading=0<h.length?h:null;this.isDeferred()||this.renderContent();a&&this.$content.trigger("inserted-element")};m.isMinimized=function(){return this.$wrapper.hasClass(l.CSS_PORTLET_MINIMALIZED_MODE)};m.isMaximized=function(){return this.$wrapper.hasClass(l.CSS_PORTLET_MAXIMALIZED_MODE)};m.renderContent=function(){NS.Logger.debug("Rendering Portlet ("+this.id+")")};m.isDeferred=function(){return this.supportsAction("load")};
m.isLoading=function(){return this.$loading&&0<this.$loading.length};m.switchContentLoaderOn=function(){this.$loading||(this.$loading=e().appendTo(this.$body),this.$wrapper.find(".ns-portlet-icon-maximize.ns-portlet-action.ns-portlet-icon").addClass("ns-portlet-maximize-disabled"))};m.switchContentLoaderOff=function(){this.$loading&&(this.$loading.remove(),this.$loading=null,this.$wrapper.find(".ns-portlet-icon-maximize.ns-portlet-action.ns-portlet-icon").removeClass("ns-portlet-maximize-disabled"))};
m.updateLoaderMessage=function(){var a=this.$loading.find(".ns-loading-message.ns-visible-message"),h=a.nextAll(".ns-loading-message").first();0<h.length&&(a.removeClass("ns-visible-message"),h.addClass("ns-visible-message"))};m.updatePortlet=function(a){a.title&&this.setTitle(a.title);a.content&&this.setContent(a.content);NS.Logger.debug("Portlet content refreshed (for "+this.getId()+")")};m.replacePortlet=function(a){a=d(a);this.previousWrapperLayoutClass=this.getCurrentWrapperLayoutClass(a[0]);
this.isMaximized()&&(a=a.removeClass(this.previousWrapperLayoutClass),a=a.addClass(l.CSS_PORTLET_MAXIMALIZED_MODE));this.$wrapper.replaceWith(a);a.trigger("portlet-restart",{portletId:this.getId(),previousWrapperLayoutClass:this.previousWrapperLayoutClass})};m.requestContent=function(a,h,u){var q=this;NS.Logger.debug("Portlet server action '"+a+"' activated (for "+this.id+")");NS.Logger.debug("Parameters:",h);this.switchContentLoaderOn();return this.getBackend().portletAction(this.getId(),a,u||{},
h).done(function(p){"object"==typeof p&&"14.2.1"==p.version&&(p.wrapper?q.replacePortlet(p.wrapper):q.updatePortlet(p))}).fail(function(p,x,B){q.switchContentLoaderOff();4>p.readyState?p.abort():q.$content.html(g(x,B))}).progress(function(p){q.updateLoaderMessage()})};m.setSetting=function(a,h){this.triggerUpdate("setting",{key:a,value:h})};m.setSettings=function(a){this.triggerUpdate("settings",a)};m.getSettings=function(){this.getBackend().portletAction(this.getId(),"get-portlet-settings").done(function(a){NS.Logger.debug(a.settings)})};
m.triggerUpdate=function(a,h){NS.Logger.debug("TriggerUpdate:",a,h);this.$wrapper.trigger("portlet-update",{portletId:this.id,property:a,options:h})};m.highlight=function(a){this.$wrapper.toggleClass("ns-highlight",a)};m.getId=function(){return this.id};m.getBackend=function(){return this.backend};m.toString=function(){return this.className+"("+this.id+")"};m.getInstanceInfo=function(){return{tooltipText:"",label:this.getTitle()}};var b={Portlet:m};m.callClassMethod=function(a,h){return b[a][h].apply(this,
Array.prototype.slice.call(arguments,2))};return{LOAD_ACTION:"load",wrapperLayoutClases:l,collectData:w,setPortletLoaderMaker:function(a){e=a},setErrorMessageMaker:function(a){g=a},setLoadBalancer:function(a){c=a},register:function(a,h){var u=m,q=u.className;if(h!==C)if(h in b)u=b[h],q=h;else throw"Unknown superclass '"+h+"'";h=Object.create(u);h.className=a;h.superClassName=q;return b[a]=h},create:function(a){var h=d(".ns-portlet-wrapper[data-portlet-id='"+a.id+"']"),u=h.find(".ns-portlet-body"),
q=u.find(".ns-portlet-content"),p=q.data("portlet-class")||m.className,x=b[p];if(x)return p=Object.create(x),d.extend(p,a,{$wrapper:h,$body:u,$content:q}),p.initialize(),NS.Logger.debug("Portlet created:",p),p;throw Error("Portlet class "+p+" has not been registered");}}}(this,NS.jQuery);(function(F,d){NS.PortletPopup=function(C){function w(){if("function"===typeof C.onBeforeHide)C.onBeforeHide();k.hide();k.attr("aria-hidden",!0);C.blockingScreen.hide()}C.popup&&C.wrapper||NS.Logger.error("No popup or wrapper defined!");var k=d(C.popup).clone(),t=d(C.wrapper),n={},r=C.setPosition;C.dragable&&k.draggable({handle:C.dragable});k.addClass("ns-portlet-popup");k.removeAttr("id");k.find("*").removeAttr("id");d("body").append(k);k.on("click",".ns-button",function(f){f.preventDefault();f.stopPropagation();
f=d(this);var l=f.data("type");if("cancel"==l)w();else if("function"===typeof C.onButtonClick)C.onButtonClick(l,n,f)});C.blockingScreen.on("click",function(){w()});return{show:function(f){if("function"===typeof C.onBeforeShow)C.onBeforeShow();if(f)if("function"===typeof r)r(f);else{var l=f.pageX;f=f.pageY+10;var m=d(F).width()-l-k.outerWidth();0>m&&(l+=m-20);0>d(F).height()-f-k.outerHeight()&&(f-=k.outerHeight()+20);k.css({top:f,left:l})}else l=k,l.width(),f=l.outerWidth(),m=l.outerHeight(),f>=t.width()&&
(f=t.width()-30,l.width(f)),f=l.outerWidth(),m=Math.max(5,t.outerHeight()/2-m/2-30),f=Math.max(5,t.outerWidth()/2-f/2),l.css({top:m,left:f});C.blockingScreen.width(t.width());C.blockingScreen.height(t.height());C.blockingScreen.show();k.show();k.attr("aria-hidden",!1)},hide:function(){w()},remove:function(){k.remove()},initialize:function(f){n=f},setMessage:function(f){var l=k.find(".ns-popup-message");l&&l.html(f)},getPopup:function(){return k},setPositionSetter:function(f){r=f}}}})(this,NS.jQuery);(function(F,d,C){NS.Dashboard.registerPlugin("QuickSelector",function(w,k){function t(){var a=NS.getCSRFToken();return d.ajax({method:"POST",url:"/app/center/setup/quickdate.nl",data:{quickdate:c.getValue(),sc:w.getId(),[a.name]:a.value}})}function n(){return t().done(function(){e?d.ajax({url:"/app/center/setup/quickbookselector.nl",data:{book:m.getValue(),sc:w.getId()}}).done(function(){r(c.getText(),m.getText())}).fail(function(a){NS.Logger.error("failed to change date and book preference. response is ",
a)}):r(c.getText())}).fail(function(a){NS.Logger.error("failed to change date and book preference. response is ",a)})}function r(){var a=k.data("title-prefix"),h=[].join.call(arguments,", ");l.html(a+": "+h)}function f(){w.triggerActionOnAllPortlets("quick_date_change",null,"Refreshing portlet: %p after quick date change");k.hide()}var l,m,e=!1,g,c;var b={toggleTooltip:function(){k.css({right:d(F).width()-l.position().left-l.outerWidth()+"px",top:l.position().top+l.height()+5+"px"});l.attr("aria-expanded",
"none"===k.css("display"));k.slideToggle(100)},changeRange:function(a){c.setValue(a);n().done(f)}};(function(){l=d("#ns-quick-date-link");c=getDropdown(k.find("input[name=quickdateselector]").get(0));var a=k.find("input[name=accountingbook]");0<a.length&&(e=!0,m=getDropdown(a.get(0)));l.attr("aria-haspopup","true");l.attr("aria-controls","nsDashboardQuickSelectorContent");l.attr("aria-expanded","false");l.click(function(){b.toggleTooltip()});NS.UI.Helpers.Accessibility.doClickOnSpaceKey(l);k.on("click",
".ns-quick-date-apply-button",function(){n().done(f)}).on("click",".ns-quick-date-cancel-button",function(){k.hide()}).on("mousemove",function(){clearTimeout(g)}).on("mouseout",function(h){clearTimeout(g);h.target==k.get(0)&&(g=setTimeout(function(){k.hide();l.attr("aria-expanded","false")},300))})})();w.registerActionHandler("quickDateRangeChange",b.changeRange,b);return b})})(this,NS.jQuery);(function(F,d){function C(k){k.$container.on("click",".ns-picker-date-label",function(){var t=d(this).data("date");"function"===typeof k.selectDateCallback&&k.selectDateCallback.call(this,t)});k.$container.on("click",".ns-picker-navigation",function(){var t=d(this).data("direction");if("today"==t)k.render(k.todayDate);else{t="next"==t?1:-1;var n=k.currentDate;n="monthly"==k.viewType?new Date(n.getFullYear()+t,n.getMonth(),1):0<t&&11==n.getMonth()?new Date(n.getFullYear()+1,0,1):0>t&&0==n.getMonth()?
new Date(n.getFullYear()-1,11,1):new Date(n.getFullYear(),n.getMonth()+t,1);k.render(n)}})}function w(k,t){k.append(d("<span data-direction='prev'></span>").addClass("ns-picker-navigation"));k.append(d("<span data-direction='next'></span>").addClass("ns-picker-navigation"));k.append(d("<span data-direction='today'></span>").addClass("ns-picker-navigation").text(t))}NS.CalendarDatepicker=function(k,t){this.$container=t;this.dayLabels=k.dayLabels;this.monthLabels=k.monthLabels;this.todayDate=k.today;
this.todayLabel=k.todayLabel;this.titleMonthDateFormat=k.titleMonthDateFormat.replace(/f[mx]|"/ig,"");this.selectDateCallback=k.selectDate;this.firstDayInWeek=k.firstDayInWeek||0;this.viewType="daily";this.currentDate=this.todayDate||new Date;C(this)};NS.CalendarDatepicker.prototype.render=function(k,t){this.currentDate=k?k:this.currentDate;this.viewType=t?t:this.viewType;"daily"==this.viewType||"weekly"==this.viewType?this.renderMonth():this.renderYear()};NS.CalendarDatepicker.prototype.renderMonth=
function(){var k=this.currentDate.getFullYear(),t=this.currentDate.getMonth(),n=(new Date(k,t,1)).getDay(),r=(new Date(k,t+1,0)).getDate(),f=d("<table class='ns-picker-table'><thead><tr><th colspan='7' class='ns-picker-title'></th></tr></thead><tbody></tbody></table>").attr("data-view-type","month"),l=f.find(".ns-picker-title");w(l,this.todayLabel);l.append(this.titleMonthDateFormat.replace("Month",this.monthLabels[t]).replace("YYYY",k));l=d("<tr></tr>");for(var m=0;6>=m;m++)l.append(d("<td></td>").addClass("ns-picker-header-day").html(this.dayLabels[(this.firstDayInWeek+
m)%7]));f.find("thead").append(l);l=f.find("tbody");for(var e=m=1;m<=r;){for(var g=d("<tr></tr>"),c=this.firstDayInWeek;c<=this.firstDayInWeek+6;c++){var b=d("<td></td>");if((1<m||(this.firstDayInWeek<=n||6<c)&&c%7==n)&&m<=r){var a=d("<span></span>").addClass("ns-picker-date-label");a.html(m);a.attr("data-date",t+1+"/"+m+"/"+k);b.html(a);b.addClass("ns-picker-significant-day");this.isToday(new Date(k,t,m))&&b.addClass("ns-today");m++}g.append(b)}l.append(g);e++}this.$container.html(f)};NS.CalendarDatepicker.prototype.renderYear=
function(){var k=this.currentDate.getFullYear(),t=d("<table class='ns-picker-table'><thead><tr><th colspan='7' class='ns-picker-title'></th></tr></thead><tbody></tbody></table>").attr("data-view-type","year"),n=t.find(".ns-picker-title");w(n,this.todayLabel);n.append(k);n=t.find("tbody");for(var r=d("<tr></tr>"),f=0;11>=f;f++){0<f&&0==f%3&&(n.append(r),r=d("<tr></tr>"));var l=d("<td></td>"),m=d("<span></span>").addClass("ns-picker-date-label");m.html(this.monthLabels[f]);m.attr("data-date",f+1+"/1/"+
k);l.html(m);l.addClass("ns-picker-significant-day");this.isTodaysMonth(new Date(k,f,1))&&l.addClass("ns-today");r.append(l)}n.append(r);this.$container.html(t)};NS.CalendarDatepicker.prototype.isTodaysMonth=function(k){return this.todayDate&&k?this.todayDate.getFullYear()==k.getFullYear()&&this.todayDate.getMonth()==k.getMonth():!1};NS.CalendarDatepicker.prototype.isToday=function(k){return this.isTodaysMonth(k)&&this.todayDate.getDate()==k.getDate()}})(this,NS.jQuery);(function(F,d,C){function w(b,a){return new NS.PortletPopup({wrapper:b,popup:b.find(".ns-event-series-popup"),blockingScreen:a,onButtonClick:function(h,u,q){h=u.url;q.data("instance")&&(h+="&_instance=T");F.location.href=h}})}function k(b,a){return new NS.PortletPopup({wrapper:b,popup:b.find(".ns-new-calendar-event-popup"),blockingScreen:a,onButtonClick:function(h,u,q){"new-event-link"==h&&(h=q.data("base-url"),h+="?ccal="+u.calendarId,u.date&&(h+="&date="+u.date),u.time&&(h+="&time="+u.time),F.location.href=
h)}})}function t(b,a,h){a.on("click",".ns-event-link",function(u){var q=d(this),p=b.eventSeriesPopup;u.preventDefault();u.stopPropagation();q.data("recurrent")?(p.initialize({url:q.attr("href")}),p.setMessage('"'+q.html()+'"'),p.show(u),h?.(this)):F.location.href=q.attr("href")})}function n(b,a,h){"daily"==b&&h.find(".ns-events-container").each(function(){f(d(this))});a.on("mouseover",".ns-event-link",function(){a.find(".ns-plus-icon").addClass("ns-hidden")});a.on("mouseout",".ns-event-link",function(){a.find(".ns-plus-icon").removeClass("ns-hidden")})}
function r(b,a){var h=d(a).parents(".ns-event-view"),u=h.data("event-id");h=h.data("event-date");const q=b.events[u][h];u=b.calendarId==b.myCalendarId||b.myCalendarId===C;h=[{fieldName:"Date",fieldValue:q.dateToPrint},{fieldName:"Start Time",fieldValue:q.startTime??"-"},{fieldName:"End Time",fieldValue:q.endTime??"-"},{fieldName:"Location",fieldValue:q.location??"-"},{fieldName:"Organizer",fieldValue:q.organizer??"-"},{fieldName:"Status",fieldValue:q.status??"-",style:{textTransform:"capitalize"}}];
const p=[];q.message&&p.push({fieldName:"Message",fieldValue:q.message,style:{whiteSpace:"pre-wrap"}});const x=[];q.actionable&&u&&(q.recurrent?(x.push({label:"Accept Series",action:()=>{B.close();m(q.id,"accepted",b)}}),x.push({label:"Decline Series",action:()=>{B.close();m(q.id,"declined",b)}})):(x.push({label:"Quick Accept",action:()=>{B.close();m(q.id,"accepted",b)}}),x.push({label:"Quick Decline",action:()=>{B.close();m(q.id,"declined",b)}})));u&&(x.push({label:"Decline This Occurrence",action:()=>
{B.close();l(q.id,q.date,"declinedinstance",b)}}),q.actionable&&!q.recurrent&&(x.push({label:"Accept",action:()=>{B.close();e(q.id,"accepted",b)}}),x.push({label:"Decline",action:()=>{B.close();e(q.id,"declined",b)}})));q.recurrent||(x.push({label:"View",action:()=>{document.location.href=g(q.baseUrl,q.id,q.date,b.calendarId,!1)}}),q.editable&&x.push({label:"Edit",action:()=>{document.location.href=g(q.baseUrl,q.id,q.date,b.calendarId,!0)}}));const B=NS.UI.Tooltip.createQuickViewTooltip({target:a,
data:{multiColumn:!0,title:q.title,fields:h,outsideFields:p,buttons:x},allowInlineHtml:!0});return B}function f(b){var a=b.find(".ns-event-view[data-timed='true']"),h=a.length;if(0<h){b=b.height();var u=!NS.UI.Util.isRedwood&&NS.jQuery("body").hasClass("ns-body__portlet-maximized")?"100%":Math.floor(b/h);a.each(function(){d(this).height(u)})}}function l(b,a,h,u){d.post(u.eventHandlerUrl,{id:b,date:a,response:h},function(){NS.Logger.debug("Status for event #"+b+", has been posted as "+h);u.triggerAction("refresh")})}
function m(b,a,h){d.post(h.eventResponseUrl,{eventId:b,response:a},function(){NS.Logger.debug("Status for event #"+b+", has been posted as "+a);h.triggerAction("refresh")})}function e(b,a,h){b=h.eventResponseUrl+"?"+d.param({response:a,eventId:b,l:"T",istimed:"T",ccal:h.calendarId});F.open(b,"responsepopup","width=700, height=500, scrollbars=yes")}function g(b,a,h,u,q){b=b+"?"+d.param({id:a,date:h,ccal:u});q&&(b+="&e=T");return b}var c=NS.Portlet.register("CalendarPortlet");c.initialize=function(){this.callClassMethod(c.superClassName,
"initialize");var b=this;this.$wrapper.on("click",".ns-create-event",function(a){var h=d(this),u=h.data("date");h=h.data("time");b.newCalendarEventPopup&&(b.newCalendarEventPopup.initialize({calendarId:b.calendarId,date:u,time:h}),b.newCalendarEventPopup.show(a))});this.$wrapper.on("click",".ns-portlet-control-panel .ns-title-primary",function(a){NS.UIF.load().then(function(h){let u=new h.Component.Calendar({tabbable:!1,viewDate:h.host.getContext(h.Core.ContextType.FORMAT).parse(b.date,h.Core.Format.DATE,
{format:"MM/dd/yyyy"}),visualStyle:h.Component.Calendar.VisualStyle.EMBEDDED,on:{[h.Component.Calendar.Event.DATE_SELECTED]:function(p){b.selectDate(`${p.currentDate.month+1}/${p.currentDate.day}/${p.currentDate.year}`);q.close()}}});const q=new h.Component.Popover({owner:b.$wrapper.find(".ns-title-primary")[0],content:u,withAnchor:!0,anchorStyle:p=>p.getComponentStyles(h.Component.Calendar).pickerAnchor,position:{placementOffset:0}});q.open()})});this.$wrapper.attr("data-original-view-type-is-agenda",
!1);this.portletBlockingScreen=d("<div class='ns-blocking-screen'></div>")};c.close=function(){[this.eventSeriesPopup,this.newCalendarEventPopup,this.datepickerPopup].forEach(function(b){b&&b.remove&&b.remove()});this.callClassMethod(c.superClassName,"close")};c.renderContent=function(){this.callClassMethod(c.superClassName,"renderContent");let b={portletCalendar:this};this.isMaximized()?(b.portletAgenda=NS.jQuery.extend(!0,{},this),b.portletCalendar.$calendarContainer=b.portletCalendar.$wrapper.find(".ns-calendar-container"),
b.portletAgenda.$calendarContainer=b.portletAgenda.$wrapper.find(".ns-calendar-agenda-container")):b.portletCalendar.$calendarContainer=b.portletCalendar.$wrapper.find(".ns-calendar-container");for(let a in b)b[a].events=b[a].$calendarContainer.data("events"),b[a].calendarId=b[a].$calendarContainer.data("calendar-id"),b[a].myCalendarId=b[a].$calendarContainer.data("my-calendar-id"),b[a].calendarName=b[a].$calendarContainer.data("calendar-name"),b[a].setViewType(b[a].$calendarContainer.data("default-view-type")),
b[a].date=b[a].$calendarContainer.data("date"),b[a].todayDate=b[a].$calendarContainer.data("today-date"),b[a].edit=b[a].$calendarContainer.data("edit"),b[a].recurrent=b[a].$calendarContainer.data("recurrent"),b[a].dashboardColumnType=this.isMaximized()?"wide":b[a].$calendarContainer.parents(".ns-dashboard-column").data("column-type"),b[a].eventResponseUrl=b[a].$calendarContainer.data("event-response-url"),b[a].eventHandlerUrl=b[a].$calendarContainer.data("event-handler-url"),b[a].$wrapper.append(b[a].portletBlockingScreen),
b[a].eventSeriesPopup=b[a].eventSeriesPopup?b[a].eventSeriesPopup:w(b[a].$wrapper,b[a].portletBlockingScreen),b[a].newCalendarEventPopup=k(b[a].$wrapper,b[a].portletBlockingScreen),b[a].setTitle(b[a].calendarName),b[a].createDayEventsTooltip(),b[a].bindEventQuickView(),n(b[a].getViewType(),b[a].$wrapper,b[a].$calendarContainer),t(b[a],b[a].$calendarContainer,h=>h._quickViewTooltip?.close())};c.selectDay=function(b){this.updateView({viewtype:"daily",date:b})};c.selectDate=function(b){this.updateView({date:b})};
c.updateView=function(b){b.viewtype&&this.setViewType(b.viewtype);this.date=b.date?b.date:this.date;this.reload("refresh")};c.switchCalendar=function(b){this.calendarId!=b?(this.calendarId=b,this.reload("refresh")):NS.Logger.debug("No-op: Calendar is already set to "+this.calendarId)};c.switchView=function(b){this.getViewType()!=b.toLowerCase()?(this.setViewType(b),this.reload("refresh")):NS.Logger.debug("No-op: Calendar view type is already set to "+this.getViewType())};c.hasCompactView=function(){return"monthly"==
this.viewType&&"narrow"==this.dashboardColumnType};c.navigate=function(b){if("today"==b)this.updateView({date:this.todayDate});else{b="prev"==b?-1:1;var a=new Date(this.date);"daily"==this.getViewType()?a=adddays(a,b):"weekly"==this.getViewType()?a=adddays(a,7*b):"monthly"==this.getViewType()?a=addmonths(a,b):NS.Logger.debug("Unsupported view type to navigate: "+this.getViewType());this.date=F.formatMMDDYYYY(a);this.reload("refresh")}};c.reload=function(b,a){if(this.isMaximized()||"true"!==this.$wrapper.attr("data-original-view-type-is-agenda"))if(this.isMaximized()&&
"agenda"===this.getViewType()){this.$wrapper.attr("data-original-view-type-is-agenda",!0);var h="monthly"}else this.isMaximized&&"monthly"!==this.getViewType()&&"true"===this.$wrapper.attr("data-original-view-type-is-agenda")&&this.$wrapper.attr("data-original-view-type-is-agenda",!1),h=this.getViewType();else this.$wrapper.attr("data-original-view-type-is-agenda",!1),h="agenda";a=d.extend(a,{calendarid:this.calendarId,date:this.date,viewtype:h});this.callClassMethod(c.superClassName,"reload",b,a)};
c.maximize=function(){this.callClassMethod(c.superClassName,"maximize");this.reload("refresh")};c.getViewType=function(){return this.viewType.toLowerCase()};c.setViewType=function(b){this.viewType=b.toLowerCase()};c.print=function(){var b=d("#ns-dashboard-content"),a=this.$wrapper.closest(".ns-dashboard-column");a:switch(this.viewType){case "agenda":var h=this.calendarName+" / "+this.viewType;break a;default:h=this.calendarName+" / "+this.$wrapper.find(".ns-title-primary").text()}h=d("<h1 class='ns-print-title'>"+
h+"</h1>");var u=a.attr("id");b.find(".ns-dashboard-column").each(function(){var q=d(this);q.attr("id")!=u&&q.addClass("ns-print-hide")});NS.Logger.debug("Printing Calendar portlet...");a.addClass("ns-print-full-page");this.$wrapper.before(h);this.$wrapper.attr("data-print-target",!0);b.attr("data-print-target",!0);F.print();NS.Logger.debug("Done printing.");this.$wrapper.attr("data-print-target",!1);b.attr("data-print-target",!1);a.removeClass("ns-print-full-page");h.remove();b.find(".ns-dashboard-column").removeClass("ns-print-hide")};
c.createDayEventsTooltip=function(){const b=this;if(b.hasCompactView())b.$calendarContainer.on("mouseenter","td",function(){var a=this.querySelector(".ns-day-events");if(0<a.children.length){if(!this._dayEventsTooltip){a=a.cloneNode(!0);const h=NS.UIF.createTooltip({target:this,content:a,visualStyle:"popover",size:"default"});t(b,d(a),()=>h.close());this._dayEventsTooltip=h}}else this._dayEventsTooltip&&(this._dayEventsTooltip.dispose(),this._dayEventsTooltip=null)})};c.bindEventQuickView=function(){const b=
this;this.$calendarContainer.on("mouseenter",":not([data-busy=true])[data-event-type=event] .ns-event-link",function(){this._quickViewTooltip||(this._quickViewTooltip=r(b,this))})}})(this,NS.jQuery);(function(F,d,C){function w(g,c){return g.toggleClass("ns-chart-icon-selected",c)}function k(g,c,b){return w(g.filter("[data-action-args='"+c+"']"),b)}function t(g,c){c=c||{};var b=c.chartObj||g.getChartObj();g=g.getChartMetadata()||{};c.chartType=c.chartType||b.options&&b.options.chart&&b.options.chart.defaultSeriesType;c.trendType=c.trendType||g&&g.trendType;c.trendComp=c.trendComp||g&&(g.isCompare?TREND_CHART_TYPE_COMPARISON:TREND_CHART_TYPE_CONTINOUS);return c}function n(g){return{trendType:g.trendType,
isCompare:g.trendComp==TREND_CHART_TYPE_COMPARISON}}function r(g){return parseInt(g.css("margin-top"))+parseInt(g.css("margin-bottom"))+parseInt(g.css("padding-top"))+parseInt(g.css("padding-bottom"))}var f=NS.Portlet.register("ChartPortlet"),l={MONTHLY:!0,QUARTERLY:!0},m={print:function(){NS.Logger.error("No printing/exporting supported when chart not present.")}};m.exportChart=m.print;m.setSize=function(){};var e=function(g){var c=this.getChartId(),b=d("#"+c),a=400;if(!0===g||this.isMaximized())a=
this.$wrapper.height()-(this.$wrapper.find(".ns-portlet-header").outerHeight(!0)+this.$wrapper.find(".ns-chart-control-panel-wrapper").outerHeight(!0)+r(this.$wrapper)+r(this.$body)+r(this.$content));b.css("height",a?a+"px":null);ChartManager.reflow(c)};f.initialize=function(){this.callClassMethod(f.superClassName,"initialize");this.$chartTypeIcons=d();var g=this;this.$wrapper.on("changeDateRange",function(c,b){g.changeDateRange(b)});this.$content.on("maximized-change",function(c,b){e.call(this,b.maximized||
!1)}.bind(this));this.$content.on("minimized-turned-off",function(){ChartManager.reflow(this.getChartId())}.bind(this));this.$wrapper.on("maximize.bodyHeightChanged",function(c,b){e.call(this)}.bind(this))};f.finalize=function(){this.$content.off("maximized-change");this.$wrapper.off("maximize.bodyHeightChanged");this.callClassMethod(f.superClassName,"finalize")};f.renderContent=function(){var g=this.getChartId(),c=this.$content.find(".ns-chart-container"),b=c.data("chart")||this.data&&this.data.chart;
this.callClassMethod(f.superClassName,"renderContent");NS.Logger.debug("Rendering ChartPortlet ("+this.id+"): ",this.data);this.$chartTypeIcons=this.$wrapper.find(".ns-portlet-action[data-action='chartType']");this.$trendCompIcons=this.$wrapper.find(".ns-portlet-action[data-action='trendComparison']");this.$icons=this.$chartTypeIcons.add(this.$trendCompIcons);b&&(0===c.length?d('<div id="'+g+'" class="ns-chart-container">').appendTo(this.$content):c.attr("id",g),this.currentChartType=b.metadata&&
b.metadata.currentChartType,ChartManager.remove(g,!0),(new ChartRenderer).render(g,b),(c=this.isMaximized())&&e.call(this,c),c=(c=void 0,t(this,c)),k(this.$chartTypeIcons,c.chartType,!0),k(this.$trendCompIcons,c.trendComp,!0),(ChartManager.get(g).metadata||{}).isPDFSupported||this.$wrapper.find('li[data-action="exportpdf"]').css("display","none"))};f.changeChartType=function(g){this.currentChartType!==g&&(NS.Logger.debug("changeChartType:",g),w(this.$chartTypeIcons,!1),changeChartType(this.getChartId(),
g),this.currentChartType=g,k(this.$chartTypeIcons,g,!0))};f.changeTrendOpts=function(g,c){var b=n(t(this));g=n(t(this,g));!g.isCompare||g.trendType in l||(c&&alert(NLChartContextStringsInstance.COMPARISON_NOT_SUPPORT_ALERT),g.isCompare=!1);if(g.trendType!=b.trendType||g.isCompare!=b.isCompare)w(this.$icons,!1),this.currentChartType&&(g.chartType=this.currentChartType),this.requestContent("trendOptionsUpdated",g)};f.changeTrendComparison=function(g){NS.Logger.debug("changeTrendComparison:",g);this.changeTrendOpts({trendComp:g},
!0)};f.changeTrendType=function(g){NS.Logger.debug("changeTrendType:",g);this.changeTrendOpts({trendType:g},!1)};f.changeDateRange=function(g){var c={dateRange:g};NS.Logger.debug("changeDateRange:",g);w(this.$icons,!1);this.currentChartType&&(c.chartType=this.currentChartType);this.requestContent("dateRangeUpdated",c)};f.changeSnapshot=function(g){NS.Logger.debug("changeSnapshot:",g);this.requestContent("snapshotUpdated",{snapshot:g})};f.print=function(){this.getChartObj().print()};f.exportCsv=function(){nlExportChartToCSV(this.getChartId())};
f.exportImg=function(g){var c=null;isEdgeBrowser()&&(c=simplifyChartColorsForPrintingInEdge(this.getChartObj().userOptions));this.getChartObj().exportChartLocal(g&&{type:g},c)};f.getChartObjInterpretation=function(){return ChartManager.get(this.getChartId())||{}};f.getChartObj=function(){var g=this.getChartObjInterpretation();return g.chart?g.chart:m};f.getChartMetadata=function(){var g=this.getChartObjInterpretation();return g.metadata?g.metadata:{}};f.getChartId=function(){return"portlet-chart_"+
this.id}})(this,NS.jQuery);(function(F,d,C){var w=NS.Portlet.register("KPIPortlet");w.initialize=function(){this.callClassMethod(w.superClassName,"initialize");var k=this,t=this.$wrapper;this.updateTimeStamp=t.data("portletUpdateTime");this.showTime=t.data("portletShowTime");t.on("mouseenter",function(){k.updateTime(k.updateTimeStamp,t)});this.$content.on("maximized-change",function(){})};w.renderContent=function(){var k=this.$wrapper.closest("div.ns-dashboard-column"),t=k&&k.data("column-type")?k.data("column-type"):null;
k=this.$content.find(".ns-kpi-snapshot-header-container > div");ChartManager.removeAllByRegex("headlined-chart-render-",!0);k.each(function(r,f){var l=f.querySelector(".ns-portlet-kpi-graph-link");l||this.classList.add("ns-kpi-portlet-headlined-no-interaction");this.onclick=function(){l&&l.click()};if("narrow"!==t){var m=f.querySelector("[data-chart-options]");if(m){var e=m.getAttribute("data-chart-options"),g=f.querySelector(".ns-portlet-subelement-loader"),c=m.querySelector(".ns-portlet-no-graph-data-message"),
b="headlined-chart-render-"+r;d.ajax(e,{async:!0}).then(function(a){a=JSON.parse(a);null!=a&&(null==a.metadata&&(a.metadata={}),a.metadata.isHeadlinedKPIGraph=!0,a.metadata.showLegend=!1,a.metadata.chartBackground="lines",a.metadata.chartBackgroundLocal="trendgraph_global_background",a.metadata.chartTitle="",a.metadata.isIndicatorPositive=m.classList.contains("ns-portlet-indicator-positive"),a.metadata.isIndicatorNegative=m.classList.contains("ns-portlet-indicator-negative"));(new ChartRenderer).render(b,
a);g.classList.add("ns-portlet-kpi-element-hidden-state")},function(){c.classList.remove("ns-portlet-kpi-element-hidden-state")});m.setAttribute("id",b)}else r=d('<div class="ns-portlet-kpi-indicator-chart"></div>'),f=f.querySelector(".ns-portlet-kpireport-header-indicator-element"),r.appendTo(f)}});if("narrow"===t){k=this.$content.find("#ns-kpi-snapshot-narrow-data-list-container");var n=k.find("ul");k.hasClass("collapsed")?n.css("display","none"):n.css("display","inline-block")}};w.updatePortlet=
function(k){this.callClassMethod(w.superClassName,"updatePortlet",k);k.updatetime&&(this.updateTimeStamp=k.updatetime,this.updateTime(this.updateTimeStamp,this.$wrapper))};w.updateTime=function(k,t){if(this.showTime&&!isNaN(parseFloat(k))){var n=(Date.now()-k)/1E3/60/60;t=t.find(".ns-portlet-update-time");k=t.html;var r=Math.floor(n),f=Math.floor(60*(n-r));n=Math.floor(60*(60*(n-r)-f));1>r&&1>f?n+=" sec":1>r?n=f+(1==f?" min":" mins"):(30<f&&r++,n=r+(1==r?" hr":" hrs"));k.call(t,"Updated "+n+" ago")}};
w.collapseGrid=function(k,t){if(d(".dashboard-refresh").length){var n=(k=this.$wrapper.closest(".ns-dashboard-column"))&&"function"===typeof k.data?k.data("column-type"):null;k=null;"wide"===n?k=this.$content.find("#ns-portlet-kpi-grid_table"):"narrow"===n&&(k=this.$content.find("#ns-kpi-snapshot-narrow-data-list-container"),n=k.find("ul"),k.find(".ns-kpi-snapshot-button-text-show").toggleClass("hidden"),k.find(".ns-kpi-snapshot-button-text-hide").toggleClass("hidden"),n.slideToggle(100));null!=k&&
(k.toggleClass("collapsed"),t.gridCollapsed=k.hasClass("collapsed"),this.getBackend().portletAction(this.id,"collapseGrid",{},t))}}})(this,NS.jQuery);(function(F,d,C){var w=NS.Portlet.register("PredictedRisksPortlet");d.fn.templating=function(t){var n=RegExp("{{#if.*?{{#/if}}","gm"),r=RegExp("^{{#if.*?}}"),f=RegExp("}}(.*){{#/if"),l=RegExp("{{[^}{]*}}","gm"),m=function(b,a){(b.match(n)||[]).forEach(function(h){var u=b,q=u.replace,p=h.match(r);var x=h.match(f);p=p[0]?p[0]:"";p=p.match(RegExp("{{#if (.*)}}"));x=x&&d.isArray(x)&&x[1]?x[1]:"";p=p&&d.isArray(p)&&p[1]?p[1]:"";x="string"===typeof p&&e(a,p.split("."))?x:"";b=q.call(u,h,x)});return b},
e=function(b,a){if("object"===typeof b){var h=a.shift();return e(b[h],a)}return b},g=function(b,a,h){a.forEach(function(u){var q=u.replace(/[{}]/g,"").split(".");q=e(h,q);null==q&&(q="");b=b.replace(new RegExp(u),q)});return b},c={applyObj:function(b,a,h){var u="";if(d.isArray(b))b.forEach(function(p){var x=m(a,p);u=u.concat(g(x,x.match(l),p))});else{"object"!==typeof b&&(b={});var q=m(a,b);u=g(q,q.match(l),b)}return h?this.empty().append(u):this.append(u)}};if(c[t])return c[t].apply(this,Array.prototype.slice.call(arguments,
1))};var k=function(t,n,r,f){var l=d.extend({},n,{source:"dashboard"});d.ajax({url:t,data:l}).done(function(m){"ok"===m.status&&m.data?r(m,n):f(m,n)}).fail(function(m){f(m)})};w.initialize=function(){this.callClassMethod(w.superClassName,"initialize")};w.renderContent=function(){this.callClassMethod(w.superClassName,"renderContent");var t='<div class="details-box" data-risk-id="{{id}}">\n<div class="top-box-container">\n   <div class="percentage-label-value-box">\n       <div class="label smallgraytextnolink"><span>'+
(NS.Translations.dictionary["NLHeadingContext.LIKELIHOOD"]||"Likelihood")+'</span></div>\n       <div class="percentage-value" data-value-type="risklikelyhood">{{confidence.value}}</div>\n   </div>\n</div>\n<div class="bottom-box-container">\n   <div class="value-box">\n       <div class="label smallgraytextnolink"><span>'+(NS.Translations.dictionary["NLHeadingContext.ITEM"]||"Item")+'</span></div>\n       <div class="value-box-value" data-value-type="riskitemnumber">{{itemNumber.label}}</div>\n   </div>\n   <div class="value-box">\n       <div class="label smallgraytextnolink"><span>'+
(NS.Translations.dictionary["NLHeadingContext.DATE"]||"Date")+'</span></div>\n       <div class="value-box-value" data-value-type="riskdate">{{date.value}}</div>\n   </div>\n</div>\n</div>',n=d("div#ns-predicted-risks-portlet-container"),r=d('<div class="tabs-wrapper"></div>'),f=d('<button type="button" class="ns-predicted-risks-portlet-previous-tab-button" title="'+(NS.Translations.dictionary["NLButtonContext.SCROLL_LEFT"]||"Scroll Left")+'" aria-label="'+(NS.Translations.dictionary["NLButtonContext.SCROLL_LEFT"]||
"Scroll Left")+'">\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="24" height="24">\n     <title>chevron-left</title>\n         <g transform="translate(0, -1)">\n             <polygon points="15.5 8.5 14 7 9 13 14 19 15.5 17.5 12 13 15.5 8.5"/>\n         </g>\n</svg>\n</button>\n<button type="button" class="ns-predicted-risks-portlet-next-tab-button" title="'+(NS.Translations.dictionary["NLButtonContext.SCROLL_RIGHT"]||"Scroll Right")+
'" aria-label="'+(NS.Translations.dictionary["NLButtonContext.SCROLL_RIGHT"]||"Scroll Right")+'">\n    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="24" height="24">\n    <title>chevron-right</title>\n        <g transform="scale(-1, 1) translate(-24, -1)">\n            <polygon points="15.5 8.5 14 7 9 13 14 19 15.5 17.5 12 13 15.5 8.5"/>\n        </g>\n    </svg>\n</button>'),l=d('<div class="tabs"></div>'),m=d('<div class="tabs-contents"></div>'),
e=d('<div class="ns-portlet-subelement-loader">\n    <div class="ns-portlet-loader__wrapper">\n        <svg viewBox="-18 -18 36 36" role="img" aria-label="'+(NS.Translations.dictionary["NLButtonContext.LOADING"]||"Loading")+'" class="ns-portlet-loader__icon--circular">\n            <circle fill="none" r="16" class="ns-portlet-loader__icon--circular__outline"></circle>\n            <circle fill="none" r="16" class="ns-portlet-loader__icon--circular__runner" transform="rotate(-135)" stroke-dasharray="100"></circle>\n        </svg>\n    </div>\n</div>'),
g=d('<div class="ns-portlet-predictedrisks-nodataavailable"><div class="ns-portlet-predictedrisks-nodataavailable-content">'+(NS.Translations.dictionary["NLPagemessageContext.NO_DATA_AVAILABLE"]||"No data available.")+"</div></div>"),c=!1;n.empty();r.append(l);r.append(f);n.append(r);n.append(m);var b=function(){var p=l.get(0),x=d("button.ns-predicted-risks-portlet-next-tab-button"),B=d("button.ns-predicted-risks-portlet-previous-tab-button"),K=p.scrollWidth,M=p.offsetWidth;p=p.scrollLeft;M===K?(B.addClass("hide"),
x.addClass("hide")):M+p===K?(B.removeClass("hide"),x.addClass("hide")):(0===p?B.addClass("hide"):B.removeClass("hide"),x.removeClass("hide"))},a=function(p){l.animate({scrollLeft:p},{duration:400,start:function(){c=!0},complete:function(){b();c=!1}})},h=function(){var p=d("div.tab-container.active"),x=d("div.tabs");null!=x[0]&&null!=x[0].scrollLeft&&null!=x[0].offsetWidth&&(p=p.position().left,a(x[0].scrollLeft+p))},u=function(p,x){p.data&&(p=p.data,x=d('<div class="one-tab-content active" data-tab-content-id='+
x.data+">"),m.append(x),0===p.length?(x.addClass("message-shown"),x.append(g)):x.templating("applyObj",p,t,!0),m.removeClass("loader-shown"),e.detach())},q=function(p){m.addClass("message-shown");m.append(g)};this.$wrapper.on("portlet-column-changed",function(p,x){x&&x.newColumnId!==x.oldColumnId&&(h(),b())});n.on("click","div.tabs div.tab-container",function(p){if(p.currentTarget&&p.currentTarget.attributes&&p.currentTarget.attributes["data-tab-content-id"]){var x=p.currentTarget.attributes["data-tab-content-id"].value;
d("div.tabs div.tab-container").removeClass("active");d("div.one-tab-content").removeClass("active");p.currentTarget.classList.add("active");p=d("div.one-tab-content[data-tab-content-id="+x+"]");0!==p.length?p.addClass("active"):(m.addClass("loader-shown"),m.append(e),k("/app/dashboard/ajaxhandler.nl?action=fetchRisks",{data:x},u,q));h()}});n.on("click","div.tabs-contents div.details-box",function(p){if(p&&p.currentTarget&&p.currentTarget.attributes&&p.currentTarget.attributes["data-risk-id"]&&p.currentTarget.attributes["data-risk-id"].value){var x=
p.currentTarget.closest("div.one-tab-content.active");if(x&&x.attributes&&x.attributes["data-tab-content-id"]&&x.attributes["data-tab-content-id"].value)var B=x.attributes["data-tab-content-id"].value;F.location.href="/app/dashboard/ctower.nl#/risks?id="+p.currentTarget.attributes["data-risk-id"].value+(B?"&category="+B:"")}else F.location.href="/app/dashboard/ctower.nl#/risks/"});r.on("click","button.ns-predicted-risks-portlet-previous-tab-button",function(p){!0!==c&&(p=l.get(0),null!=p&&a(p.scrollLeft-
p.offsetWidth/3))});r.on("click","button.ns-predicted-risks-portlet-next-tab-button",function(p){!0!==c&&(p=l.get(0),null!=p&&a(p.scrollLeft+p.offsetWidth/3))});k("/app/dashboard/ajaxhandler.nl?action=fetchRiskCategories",null,function(p){if(p&&p.data&&(p=p.data,l.templating("applyObj",p,'<div class="tab-container-wrapper">\n    <div class="tab-container"  data-tab-content-id={{id}}>\n        <div class="ns-pred-risks-portlet-tab-title">{{label}}</div>\n        <div class="ns-pred-risks-portlet-tab-count">{{count}}</div>\n    </div>\n</div>',
!1),0<p.length&&"object"===typeof p[0])){p=p[0];var x=p.id,B=typeof x;"object"===B?x.classList&&x.classList.add?x.classList.add("active"):x.addClass&&x.addClass("active"):("string"===B||"number"===B)&&d("div.tab-container[data-tab-content-id="+x+"]").addClass("active");b();m.addClass("loader-shown");m.append(e);k("/app/dashboard/ajaxhandler.nl?action=fetchRisks",{data:p.id},u,q)}},function(p){n.empty();n.append(g)})}})(this,NS.jQuery);(function(F,d,C){var w=NS.Portlet.register("ReconciliationSummaryPortlet");w.sortField="";w.sortDirection="";w.renderContent=function(){var k=this;this.callClassMethod(w.superClassName,"renderContent");this.loadReport();this.$searchText=this.$content.find("#ns-bankrec-searchtext");this.$searchText.on("keyup",function(){k.loadReport()});this.$viewFilter=this.$content.find("#ns-bankrec-view-filter");this.$viewFilter.on("change",function(){k.loadReport()});this.$columnHeaders=this.$content.find(".ns-bankrec-list-col-header > .ns-bankrec-list-col");
this.$columnHeaders.on("click",function(){k.sort(d(this).data("sort-field"))})};w.loadReport=function(){var k=this;this.$searchText=this.$content.find("#ns-bankrec-searchtext");this.$viewFilter=this.$content.find("#ns-bankrec-view-filter");promise=this.requestContent("getAccountSummary",{searchText:this.$searchText.val(),viewFilter:this.$viewFilter.val(),sortField:this.sortField,sortDirection:this.sortDirection});promise.done(function(t){var n=k.$content.find(".ns-bankrec-portlet-list-row.ns-bankrec-template"),
r=k.$content.find(".ns-bankrec-list-col-header");k.$content.find(".ns-bankrec-portlet-list-row").not(".ns-bankrec-template, .ns-bankrec-list-col-header").remove();k.displaySortDirection();if(t.report&&0<t.report.length){r.removeClass("ns-bankrec-hidden");k.$content.find(".ns-bankrec-tile-message").hide();var f=[];t.report.forEach(function(l){function m(g,c,b){g.find(c).text(b)}var e=n.clone();e.removeClass("ns-bankrec-template");(l.account.type=t.canViewBankRegister)||(l.account.type=t.canViewCreditCardRegister)?
e.find(".ns-bankrec-list-col-name-val").append(d('<a href="'+t.accountRegisterUrl+"?acctid="+l.account.id+'&reload=T&outputtype=3&reporttype=REGISTER"></a>').text(l.account.displayName)):m(e,".ns-bankrec-list-col-name-val",l.account.displayName);m(e,".ns-bankrec-list-col-currency-val",l.account.currency.isoCode);m(e,".ns-bankrec-list-col-account-balance-val",l.accountBalanceDisplayValue);m(e,".ns-bankrec-list-col-last-reconciled-balance-val",l.lastReconciledBalanceDisplayValue);m(e,".ns-bankrec-list-col-last-reconciled-on-val",
l.lastReconciledOnDisplayValue);l.reconcileWithMatching?(e.find(".ns-bankrec-list-col-unreconciled-transaction-count-val").append(d('<a href="'+t.confirmationUrl+"?acctid="+l.account.id+'"></a>').text(l.unreconciledTransactionCount)),m(e,".ns-bankrec-list-col-bank-statement-balance-val",l.bankStatementBalanceDisplayValue),m(e,".ns-bankrec-list-col-last-uploaded-on-val",l.lastStatementOnDisplayValue)):(m(e,".ns-bankrec-list-col-unreconciled-transaction-count-val","-"),m(e,".ns-bankrec-list-col-bank-statement-balance-val",
"-"),m(e,".ns-bankrec-list-col-last-uploaded-on-val","-"));f.push(e)})}else k.$content.find(".ns-bankrec-tile-message > h2").text(t.message),k.$content.find(".ns-bankrec-tile-message").show(),r.addClass("ns-bankrec-hidden");k.$importLink=k.$content.find("#ns-upload-statement-link-container");t.importPermission||k.$importLink.hide();k.$matchingRulesLink=k.$content.find("#ns-matching-rules-link-container");t.matchingRulesPermission||k.$matchingRulesLink.hide();k.$reconciliationReportLink=k.$content.find("#ns-reconciliation-report-link-container");
t.reconcileReportPermission||k.$reconciliationReportLink.hide();k.switchContentLoaderOff();k.$content.find("#ns-bankrec-report-list").append(f).show()});return promise};w.sort=function(k){this.sortDirection=this.sortField===k?"ASC"===this.sortDirection?"DESC":"ASC":"ASC";this.sortField=k;this.loadReport()};w.displaySortDirection=function(){var k=this;this.$columnHeaders.each(function(){d(this).data("sort-field")===k.sortField?d(this).find(".ns-bankrec-sort-direction").attr("class","ns-bankrec-sort-direction "+
("ASC"===k.sortDirection?"listheadersortup":"listheadersortdown")):d(this).find(".ns-bankrec-sort-direction").attr("class","ns-bankrec-sort-direction")})}})(this,NS.jQuery);(function(F,d,C){var w=NS.Portlet.register("RemindersPortlet");w.initialize=function(){this.callClassMethod(w.superClassName,"initialize");this.portletBlockingScreen=d("<div class='ns-blocking-screen'></div>")};w.renderContent=function(){this.callClassMethod(w.superClassName,"renderContent");var k=d("div.ns-reminder-delimiter"),t=this,n=this.$wrapper.find(".ns-reminders .ns-body-reminders, .ns-reminders .ns-header-reminders");n.sortable({connectWith:".ns-connected-reminders",dropOnEmpty:!0,tolerance:"pointer",
start:function(f,l){k.addClass("ns-reminder-sorting");n.addClass("ns-reminder-sorting");this.updated=!1},stop:function(f,l){t._saveOrder();this.updated=!1;n.removeClass("ns-reminder-sorting");t._toggleLineBetweenReminderTypes()},handle:this.$wrapper.find(".ns-reminder-item:not(.ns-reminder-item-locked)"),cancel:".ns-reminder-item-label > a, .ns-reminder-item-edit",placeholder:"ns-reminder-sort-highlight"}).disableSelection();this._toggleLineBetweenReminderTypes();var r=!1;this.$wrapper.find(".ns-reminder-item").mousedown(function(){r=
!0});this.$wrapper.find(".ns-reminder-item-label > a, .ns-reminder-item-edit").mousedown(function(f){r=!1;f.stopPropagation()});this.$wrapper.mousemove(function(){r&&(n.addClass("ns-reminder-sorting"),k.removeClass("ns-reminders-hidden"))});this.$wrapper.mouseup(function(){r=!1;t._toggleLineBetweenReminderTypes();n.removeClass("ns-reminder-sorting")})};w.close=function(){[this.eventSeriesPopup,this.newCalendarEventPopup,this.datepickerPopup,this.tooltip].forEach(function(k){k&&k.remove&&k.remove()});
this.callClassMethod(w.superClassName,"close")};w.setup=function(){this.reminderSetup&&this.reminderSetup.removeSetup.bind(this.reminderSetup).call();this.reminderSetup=new NS.RemindersPortletSetup({saveCallback:this._saveSelectedReminders.bind(this),automation:this.$wrapper.data("automation")});this.reminderSetup.createSetup.bind(this.reminderSetup).call();var k=this.reminderSetup.initAndRender.bind(this.reminderSetup);this.getBackend().portletAction(this.getId(),"setup","",{}).done(function(t){k(t)})};
w._toggleLineBetweenReminderTypes=function(){var k=this.$wrapper.find(".ns-reminders .ns-header-reminders"),t=this.$wrapper.find(".ns-reminders .ns-body-reminders"),n=this.$wrapper.find(".ns-reminder-delimiter");0<k.children().length&&0<t.children().length?n.removeClass("ns-reminders-hidden"):n.addClass("ns-reminders-hidden")};w._saveSelectedReminders=function(k){k={headlineItems:JSON.stringify(k.headline),standardItems:JSON.stringify(k.standard),zeroResults:k.zeroResults};this.postReload("reminderSave",
k)};w.reminderEdit=function(k){var t=this.$wrapper.find("#"+k),n={},r=t.data("reminderHeaderLabel");n.days=t.data("reminderDays");n.reminderDaysDescription=t.data("reminderDaysDescription");var f=0<this.$wrapper.find(".ns-header-reminders").find(t).length;n.headline=f;n.highlight=t.data("reminderHighlight")||[];this.editWindow&&this.editWindow.remove();this.editWindow=this._createEditWindow(k);this._initializeEdit(this.editWindow,n,r);this.editWindow.show()};w._initializeEdit=function(k,t,n){var r=
this,f=k.getPopup();this.highlightArea=f.find(".ns-reminder-color-rules");f.find(".ns-popup-header-title").html((NS.Translations.dictionary["NLFormlabelContext.EDIT_REMINDER"]||"Edit Reminder")+": "+n).text();f.hasDays=t.days!=C;f.hasDays?(f.find("[name='days']").val(t.days),f.find(".ns-reminder-days-description").text(t.reminderDaysDescription)):f.find(".ns-reminder-days").hide();f.find("[name='headline']").prop("checked",t.headline);d.each(t.highlight,function(l,m){r.highlightArea.append(r._colorItem(m))});
f.find(".ns-reminder-add-rule").click(function(l){r.highlightArea.append(r._colorItem())});f.on("click",".ns-popup-header-close",function(l){k.remove()})};w._createEditWindow=function(k){var t=this,n=new NS.PortletPopup({wrapper:F,popup:this.$wrapper.find(".ns-reminders-edit-template"),blockingScreen:this.portletBlockingScreen,onButtonClick:function(r,f,l){switch(r){case "remove":t._deleteReminder(k);break;case "done":t._saveEditedReminder(k,n.getPopup())}n.remove()}});return n};w._deleteReminder=
function(k){this.postReload("reminderDelete",{reminder:k})};w._saveEditedReminder=function(k,t){var n=[];t.find(".ns-reminder-color-rules .ns-reminder-highlight-item").each(function(f,l){f=d(l).find(".ns-colorpicker").data("color");l=parseInt(d(l).find("[name='limit']").val());n.push({color:f,limit:isNaN(l)?0:l})});var r=parseInt(t.find("[name='days']").val());k={reminder:k,hasDays:t.hasDays,days:isNaN(r)?0:r,headline:t.find("[name='headline']").prop("checked"),highlight:JSON.stringify(n)};this.postReload("reminderEdit",
k)};w._colorItem=function(k){var t=this,n=this.$wrapper.find(".ns-reminder-colorpicker-template").clone(),r=n.find(".ns-picker-place-holder"),f=new NS.ColorPicker;r.append(f.element);r=n.find("[name='limit']");n.find(".ns-delete").click(function(l){n.remove()});r.change(function(l){t._checkLimit(l&&l.target.value||0)});k&&k.limit&&r.val(k.limit);k&&k.color&&(k=NS.UI.Util.isRedwood?this._mapRefreshedColorToRedwood(k.color):k.color,f.set(k));return n};w._mapRefreshedColorToRedwood=function(k){switch(k){case "rgb(255, 202, 0)":case "rgb(244, 126, 37)":case "rgb(178, 141, 2)":case "rgb(100, 79, 0)":return"#e18212";
case "rgb(246, 76, 96)":case "rgb(255, 19, 0)":case "rgb(197, 14, 0)":case "rgb(155, 11, 0)":return"#D63B25";case "rgb(83, 128, 166)":case "rgb(3, 137, 156)":case "rgb(128, 0, 128)":case "rgb(0, 0, 255)":return"#00688c";case "rgb(39, 173, 64)":case "rgb(0, 195, 34)":case "rgb(0, 151, 26)":case "rgb(0, 118, 21)":return"#508223";default:return k}};w._checkLimit=function(k){k=Number(k);var t=0;this.highlightArea.find("[name='limit']").each(function(n,r){Number(r.value)==k&&t++});1<t&&alert(NS.Translations.dictionary["NLAlertContext.SAME_RULE_HAS_BEEN_ALREADY_APPLIED"]||
"Same rule has been already applied.")};w._saveOrder=function(k){var t=[],n=[];this.$wrapper.find(".ns-reminders .ns-header-reminders .ns-reminder-item").each(function(r,f){t.push(f.id)});this.$wrapper.find(".ns-reminders .ns-body-reminders .ns-reminder-item").each(function(r,f){n.push(f.id)});k={headlineItems:JSON.stringify(t),standardItems:JSON.stringify(n)};this.getBackend().portletAction(this.getId(),"reminderSaveOrder",{requestType:"POST"},k)}})(this,NS.jQuery);(function(F,d){function C(f,l,m,e){var g=document.createElement("div");g.id=f;g.className="ns-setup-item"+(m?" ns-custom-reminder":"");g.onclick=function(){e._moveItem(f)};m=n("span","ns-reminder-item-icon");var c=document.createElement("span");c.innerHTML=l;g.appendChild(m);g.appendChild(c);return g}function w(){var f=n("div","ns-reminders-popup"),l=n("div","ns-popup-header"),m=n("span","ns-popup-header-title");m.innerHTML=NS.Translations.dictionary["NLHeadingContext.SELECT_REMINDERS"]||"Select reminders";
var e=n("span","ns-popup-header-close");l.appendChild(m);l.appendChild(e);var g=n("div","ns-popup-body-items"),c=n("div","ns-popup-body-controls"),b=n("div","ns-popup-body"),a=n("div","ns-dragable-panel-left"),h=n("div","ns-dragable-left"),u=n("span","ns-dragable-main-title");u.innerHTML=NS.Translations.dictionary["NLHeadingContext.CLICK_OR_DRAG_TO_ADD"]||"Click or Drag to Add";var q=n("div","ns-dragable-panel-right");m=n("div","ns-dragable-right");var p=n("div","ns-dragable-title"),x=n("span","ns-dragable-main-title");
x.innerHTML=NS.Translations.dictionary["NLHeadingContext.CURRENT_SELECTIONS"]||"Current Selections";var B=n("span","ns-dragable-sub-title");B.innerHTML="("+(NS.Translations.dictionary["NLHeadingContext.DRAG_TO_REORDER"]||"Drag to reorder")+")";e=n("div","ns-dragable-header connected-target-area");var K=n("div","ns-dragable-body connected-target-area"),M=document.createElement("h2"),I=document.createElement("h2");M.innerHTML=NS.Translations.dictionary["NLHeadingContext.HEADLINE"]||"Headline";I.innerHTML=
NS.Translations.dictionary["NLHeadingContext.OTHER"]||"Other";var L=n("div","ns-control-item"),D=document.createElement("select");D.name="remindersPagination";D.classList.add("uir-input-dropdown-native");var H=n("span","ns-control-item");H.innerHTML=NS.Translations.dictionary["NLFormlabelContext.TYPE"]||"Type";var G=n("select","ns-control-item");G.name="remindersType";G.classList.add("uir-input-dropdown-native");G.appendChild(t(r.ALL,NS.Translations.dictionary["NLStaticlistContext.ALL"]||"All"));
G.appendChild(t(r.STANDARD,NS.Translations.dictionary["NLFormlabelContext.STANDARD"]||"Standard"));G.appendChild(t(r.CUSTOM,NS.Translations.dictionary["NLFormlabelContext.CUSTOM"]||"Custom"));var Z=n("span","ns-control-item ns-control-item__search-label");Z.innerHTML=NS.Translations.dictionary["NLFormlabelContext.SEARCH"]||"Search";var S=n("input","ns-control-item ns-control-item__search");S.classList.add("uir-input-text");S.name="remindersSearch";S.type="text";var T=document.createElement("div"),
Y=n("div","ns-buttons-container");Y.appendChild(k(NS.Translations.dictionary["NLButtonContext.SAVE"]||"Save","pgBntB","save"));Y.appendChild(k(NS.Translations.dictionary["NLButtonContext.CANCEL"]||"Cancel","pgBntG","cancel"));f.appendChild(l);f.appendChild(b);f.appendChild(Y);b.appendChild(c);b.appendChild(g);b.appendChild(T);c.appendChild(H);c.appendChild(G);c.appendChild(Z);c.appendChild(S);c.appendChild(L);L.appendChild(D);g.appendChild(a);g.appendChild(q);a.appendChild(u);a.appendChild(h);p.appendChild(x);
p.appendChild(B);q.appendChild(p);q.appendChild(m);l=T.appendChild;g=NS.Translations.dictionary["NLFormlabelContext.SHOW_REMINDERS_WITH_ZERO_RESULTS"]||"Show reminders with zero results";c=n("span","ns-portlet-checkbox");b=document.createElement("input");b.setAttribute("type","checkbox");b.name="portleOptionZeroResult";b.classList.add("uir-check-box");a=n("label");h=n("span");h.innerHTML=g;a.appendChild(b);a.appendChild(h);c.appendChild(a);l.call(T,c);m.appendChild(M);m.appendChild(e);m.appendChild(I);
m.appendChild(K);return f}function k(f,l,m){var e=document.createElement("span");e.className="ns-button "+l+" uir-button";e.setAttribute("data-type",m);e.setAttribute("data-button-type","pgBntB"===l?"primary":"default");e.setAttribute("data-with-label","true");e.innerHTML=f;return e}function t(f,l){var m=document.createElement("option");m.text=l||f;m.value=f;return m}function n(f,l){f=document.createElement(f);f.className=l||"";return f}var r={STANDARD:"standard",CUSTOM:"custom",ALL:"all"};NS.RemindersPortletSetup=
function(f){this.page=0;this.data={};this.sourceData={};this.filteredSource=[];this.pageSize=f.pageSize||500;this.portletBlockingScreen=d("<div class='ns-blocking-screen'></div>");this.automation=f.automation||!1;this.saveCallback=f.saveCallback};NS.RemindersPortletSetup.prototype.createSetup=function(){this.setupWindow=this._createSetupWindow();this.loader=NS.Dashboard.makePortletLoader().appendTo(this.setupWindow.getPopup())};NS.RemindersPortletSetup.prototype.removeSetup=function(){this.setupWindow&&
this.setupWindow.remove()};NS.RemindersPortletSetup.prototype.initAndRender=function(f){this._initializeSetup(f);this.loader.remove();this._renderContent()};NS.RemindersPortletSetup.prototype._createSetupWindow=function(){var f=this,l=new NS.PortletPopup({wrapper:F,popup:w(),blockingScreen:this.portletBlockingScreen,onButtonClick:function(m,e,g){f.saveCallback(f._getReminderSetupOptions());l.remove()}});l.show();return l};NS.RemindersPortletSetup.prototype._initializeSetup=function(f){var l=this,
m=this.setupWindow.getPopup();this.setupSourceArea=m.find(".ns-dragable-left");this.prefixFilter="";this.typeFilter=r.ALL;this.setupTarget=m.find(".ns-dragable-right");this.setupTargetHeader=m.find(".ns-dragable-header");this.setupTargetBody=m.find(".ns-dragable-body");this.selectedHeadlineItems=f.selectedHeadlineItems;this.selectedStandardItems=f.selectedStandardItems;m.on("click",".ns-popup-header-close",function(e){l.setupWindow.remove()});d(".ns-dragable-header, .ns-dragable-body").sortable({connectWith:".connected-target-area",
helper:"clone"});this.setupSourceArea.sortable({connectWith:".connected-target-area",helper:"clone",remove:function(e,g){e=g.item.attr("id");l.sourceData[e].selected=!0;l._renderReminderSetupList()},stop:function(e,g){d.contains(this,g.item.get(0))&&l._renderReminderSetupList()}});this.setupSourceArea.droppable({drop:function(e,g){e=g.draggable.attr("id");l._removeReminder(e)}});d.each(f.allItems,function(e,g){l.filteredSource.push(e);l.sourceData[e]={value:g.value,custom:g.custom,selected:!1}});
m.find("[name='remindersType']").change(this._filterSource.bind(this));m.find("[name='remindersSearch']").keyup(this._search.bind(this));this.portleOptionZeroResult=m.find("[name='portleOptionZeroResult']");this.portleOptionZeroResult.prop("checked",f.zeroResults||!1);this.paginationSelect=m.find("[name='remindersPagination']");this.filteredSource.length>this.pageSize?this.paginationSelect.change(this._changePage.bind(this)):this.paginationSelect.hide();this.automation&&m.data("automation","loaded")};
NS.RemindersPortletSetup.prototype._renderContent=function(){var f=this;d.each(this.selectedHeadlineItems,function(l){f._addReminder(l,f.setupTargetHeader)});d.each(this.selectedStandardItems,function(l){f._addReminder(l,f.setupTargetBody)});this._renderReminderSetupList()};NS.RemindersPortletSetup.prototype._fillPagination=function(){var f=this,l=1,m=null,e=null,g=0,c=this.paginationSelect[0];this.filteredSource.length<this.pageSize?this.paginationSelect.css("visibility","hidden"):(this.paginationSelect.css("visibility",
"visible"),this.paginationSelect.empty(),d.each(this.filteredSource,function(b,a){b=f.sourceData[a];b.selected||(e=b.value,null==m&&(m=b.value),0==l++%f.pageSize&&(c.add(t(g++,m+" - "+e)),e=m=null))}),null!=m&&null!=e&&c.add(t(g++,m+" - "+e)),c.value=this.page)};NS.RemindersPortletSetup.prototype._changePage=function(f){this.page=d(f.target).val();this._renderReminderSetupList()};NS.RemindersPortletSetup.prototype._renderReminderSetupList=function(){var f=this;this.setupSourceArea.empty();var l=0,
m=this.page*this.pageSize,e=m+this.pageSize;d.each(this.filteredSource,function(g,c){g=f.sourceData[c];g.selected||(l++,l>m&&l<=e&&(c=C(c,g.value,g.custom,f),f.setupSourceArea.append(c)))});this._fillPagination()};NS.RemindersPortletSetup.prototype._getReminderSetupOptions=function(){var f=[],l=[],m=this.portleOptionZeroResult.prop("checked")||!1;this.setupTargetHeader.find(".ns-setup-item").each(function(e,g){f.push(g.id)});this.setupTargetBody.find(".ns-setup-item").each(function(e,g){l.push(g.id)});
return{headline:f,standard:l,zeroResults:m}};NS.RemindersPortletSetup.prototype._moveItem=function(f){0!=this.sourceData[f].length&&(this.sourceData[f].selected?this._removeReminder(f):(this._addReminder(f,this.setupTargetBody),this._renderReminderSetupList()))};NS.RemindersPortletSetup.prototype._addReminder=function(f,l){0!=this.sourceData[f].length&&(this.sourceData[f].selected=!0);var m=this.setupSourceArea.find("#"+f);0==m.length&&(m=this.sourceData[f],m=C(f,m.value,m.custom,this));l.append(m)};
NS.RemindersPortletSetup.prototype._removeReminder=function(f){0!=this.sourceData[f].length&&(this.sourceData[f].selected=!1);f=this.setupTarget.find("#"+f);0!=f.length&&(f.remove(),this._renderReminderSetupList())};NS.RemindersPortletSetup.prototype._filterSource=function(f){this.typeFilter=d(f.target).val();this._filter()};NS.RemindersPortletSetup.prototype._search=function(f){this.prefixFilter=f.target.value.toLowerCase();this._filter()};NS.RemindersPortletSetup.prototype._filter=function(f){var l=
this,m=this.typeFilter||r.ALL,e=this.prefixFilter||"";this.page=0;this.filteredSource=[];d.each(this.sourceData,function(g,c){if(m==r.CUSTOM&&!c.custom||m==r.STANDARD&&c.custom)return!0;-1!=c.value.toLowerCase().indexOf(e)&&l.filteredSource.push(g)});this._renderReminderSetupList()}})(this,NS.jQuery);(function(F,d,C){var w=NS.Portlet.register("ScriptablePortlet");w.setContent=function(k){var t=this.$content;this.$hiddenLoadingMarker=d('<div class="ns-hidden-loading-marker"></div>').appendTo(t);t.append(k);k=this.$hiddenLoadingMarker.nextAll();k.find("script").remove();this.data=NS.Portlet.collectData(k);"form"!==this.data.scriptType&&(this.renderLoadedContent(!0),this.switchContentLoaderOff())};w.renderLoadedContent=function(k){this.$hiddenLoadingMarker&&(this.$hiddenLoadingMarker.prevUntil().add(this.$hiddenLoadingMarker).remove(),
delete this.$hiddenLoadingMarker,this.switchContentLoaderOff());this.callClassMethod(w.superClassName,"renderLoadedContent",k)};w.renderContent=function(){if("html"===this.data.scriptType){var k=this.$content.find(".ns-script-portlet-content-wrapper");this.setHtmlContent(this.$content,k,this.data.htmlContent)}};w.setHtmlContent=function(k,t,n){if(n.includes("NS.UIF."))NS.UIF.load().then(function(){t.html(n)});else{var r=d("<iframe />",{style:"display: none;"});k.append(r);r.on("load",function(){t.get(0).innerHTML=
f.getElementById("ns-html-script-body").innerHTML;t.find("script").remove();r.remove()});var f=r.contents().get(0);f.open("text/html","replace");f.write(this.wrapHtmlInPage(n));f.close()}};w.wrapHtmlInPage=function(k){return'<!DOCTYPE html><html><body id="ns-html-script-body">'+k+"</body></html>"}})(this,NS.jQuery);(function(F,d,C){function w(){if(!NS.UI.Util.isRedwood){var r=this.$wrapper.find(".ns-search-result-container"),f=this.$wrapper.height()-(r.find(".uir-control-bar").outerHeight(!0)+r.find(".portletFilterBar").outerHeight(!0)+this.$wrapper.find(".ns-portlet-header").outerHeight(!0)),l=t(this.$wrapper)+t(this.$body)+t(this.$content)+t(r.find(".uir-list-table-container"));r.find(".uir-list-table-container").height(f-l)}}function k(r,f){d.each(r,function(){this.span&&this.span.id&&0<f.has("#"+this.span.id).length&&
delete r[this.name]})}function t(r){return parseInt(r.css("margin-top"))+parseInt(r.css("margin-bottom"))+parseInt(r.css("padding-top"))+parseInt(r.css("padding-bottom"))}var n=NS.Portlet.register("SearchResultPortlet");n.initialize=function(){this.callClassMethod(n.superClassName,"initialize");this.$wrapper.on("maximize.bodyHeightChanged",function(){this.chartData||w.call(this)}.bind(this));this.$wrapper.on("list-page-changed",function(){this.isMaximized()&&w.call(this)}.bind(this));this.$content.on("minimized-turned-off",
function(){ChartManager.reflow("portletHC_child_portlet_"+this.id)}.bind(this))};n.countAvailableSpace=function(){return this.$wrapper.height()-(this.$wrapper.find(".ns-portlet-header").outerHeight(!0)+this.$wrapper.find("table.uir-list-filter-bar").outerHeight(!0)+t(this.$body)+t(this.$content))};n.adjustChartContainerHeight=function(){var r="portletHC_child_portlet_"+this.id,f=d("#"+r),l=400;this.isMaximized()&&(l=this.countAvailableSpace());f.css("height",l?l+"px":null);ChartManager.reflow(r)};
n.beforeChartRender=function(r,f,l,m){var e=(new ChartRenderer)._beforeRender;this.adjustChartContainerHeight();e(r,f,l,m)};n.afterChartRender=function(r,f,l,m){var e=(new ChartRenderer)._afterRender;this.switchContentLoaderOff();e(r,f,l,m)};n.renderContent=function(){this.callClassMethod(n.superClassName,"renderContent");var r=this.$wrapper.find(".ns-search-result-container");this.$wrapper.closest(".ns-dashboard-column").data("column-type");this.chartData=r.data("chart");this.chartId=r.data("id");
this.searchTypePrefix=r.data("search-type-prefix");this.portletTitleLabel=r.data("portlet-title-label");if(this.chartData){r=this.chartId;var f=this.chartData,l=new ChartRenderer({beforeRender:this.beforeChartRender.bind(this),afterRender:this.afterChartRender.bind(this)});l.render&&(this.switchContentLoaderOn(),ChartManager.remove(r,!0),l.render(r,f))}else this.isMaximized()&&w.call(this);k(F.menus,this.$content)};n.getInstanceInfo=function(){var r=this.callClassMethod(n.superClassName,"getInstanceInfo");
return d.extend(r,{tooltipText:this.portletTitleLabel?this.portletTitleLabel+": <b>"+this.getTitle()+"</b>":"",label:this.searchTypePrefix?this.searchTypePrefix+": "+this.getTitle():this.getTitle()})};n.maximize=function(r,f){this.callClassMethod(n.superClassName,"maximize");this.reload("maximize",{maximized:this.isMaximized()})}})(this,NS.jQuery);(function(F,d,C){function w(n){n.each(function(){var r=d(this).find(".ns-tasklink-text-highlight");r.replaceWith(r.text())});n.removeClass("ns-tasklink-highlight")}var k=NS.Portlet.register("TaskLinksPortlet"),t=["ACTIVITIES","CUSTOMER_HOME","PARTNER_HOME","CUSTOMER_DASHBOARD","VENDOR_DASHBOARD"];k.renderContent=function(){this.callClassMethod(k.superClassName,"initialize");var n=this;this.$categories=this.$content.find(".ns-link-category");-1==d.inArray(this.dashboardType,t)&&this.$categories.find(".ns-link-category-title").click(function(){var r=
d(this).parents(".ns-link-category"),f=!r.data("expanded"),l=r.data("task-id");n.toggleCategory(r,f);n.updateCategoryExpanded(f,l);r.attr("data-expanded",f)});this.$allButtons=this.$content.find(".ns-tasklink-controls .ns-link-button");this.$allButtons.click(function(){var r=d(this).data("expand");n.toggleAllCategories(r);n.updateCategoryExpanded(r)});this.$input=this.$content.find(".ns-tasklink-input");this.$input.keyup(function(){setTimeout(function(){n.search()},100)});this.$searchables=this.$content.find(".ns-searchable-value");
-1!=d.inArray(this.dashboardType,t)&&this.toggleAllCategories(!0)};k.toggleCategory=function(n,r){var f=n.find(".ns-link-category-contents");r?f.slideDown():f.slideUp();n.find(".ns-link-category-icon").toggleClass("ns-icon-expand",!r);n.data("expanded",r)};k.toggleAllCategories=function(n){var r=this;this.$categories.each(function(){r.toggleCategory(d(this),n)})};k.updateCategoryExpanded=function(n,r){n={expanded:n};r&&(n=d.extend(n,{taskid:r}));this.getBackend().portletAction(this.getId(),"updateCategoryExpanded",
{},n)};k.search=function(){w(this.$searchables);var n=this,r=this.$input.val();null==r||1>r.length?n.restoreAllCategories():this.$searchables.each(function(){var f=d(this);if(0<=f.text().toUpperCase().indexOf(r.toUpperCase())){var l=f.html().toUpperCase().indexOf(r.toUpperCase()),m=l+r.length;l=f.html().substring(l,m);f.html(f.html().replace(l,"<span class='ns-tasklink-text-highlight'>"+l+"</span>"));f.addClass("ns-tasklink-highlight");n.toggleCategory(f.parents(".ns-link-category"),!0)}})};k.createNew=
function(n){F.location.href=n};k.restoreAllCategories=function(){var n=this;this.$categories.find(".ns-link-category-title").each(function(r,f){r=d(f).parents(".ns-link-category");f="true"===r.attr("data-expanded").toLowerCase();n.toggleCategory(r,f)})}})(this,NS.jQuery);(function(F,d,C){function w(e,g,c){if(e){var b=d("<div>");k(b,e,g,c);return b}}function k(e,g,c,b){g&&e.append(d("<span>",{text:c,class:b}))}function t(e,g,c,b,a){g&&e.append(d("<a>",{href:b,text:c,class:a}))}function n(e,g){function c(b,a){var h=d("<div>");b.name?(h.append(d("<span>",{text:a,class:"ns-timeline-details-secondary"})),b.email?h.append(d("<span>",{text:b.name+" <"+b.email+">",class:"ns-timeline-details-secondary"})):h.append(d("<span>",{text:b.name,class:"ns-timeline-details-secondary"}))):
b.email&&(h.append(d("<span>",{text:a,class:"ns-timeline-details-secondary"})),h.append(d("<span>",{text:"<"+b.email+">",class:"ns-timeline-details-secondary"})));return h}e.append(c(g.author,"From:"));g.toRecipients.forEach(function(b,a,h){3>a?e.append(c(b,"To:")):4>a&&e.append(r("To:",h.length-3))});g.ccRecipients.forEach(function(b,a,h){3>a?e.append(c(b,"Cc:")):4>a&&e.append(r("Cc:",h.length-3))});g.bccRecipients.forEach(function(b,a,h){3>a?e.append(c(b,"Bcc:")):4>a&&e.append(r("Bcc:",bccRecipients.length-
3))});g.messagePreview&&e.append(w(g.messagePreview,g.messagePreview,"ns-timeline-details-message"));g.attachments.forEach(function(b,a,h){3>a?(a=d("<div>"),t(a,b.name,b.name,b.url,"ns-timeline-details-secondary"),k(a,b.size,"("+b.size+") ","ns-timeline-details-secondary"),e.append(a)):4>a&&e.append(r("",h.length-3))})}function r(e,g){e=d("<span>",{text:e,class:"ns-timeline-details-secondary"});g=d("<span>",{text:"<"+g+"> "+this.label_more,class:"ns-timeline-details-secondary"});var c=d("<div>");
c.append(e,g);return c}var f=NS.Portlet.register("TimelinePortlet"),l={},m=!!navigator.userAgent.match(/Trident\/7\./);f.initialize=function(){this.filterChangeTimeout=null;this.model={};this.types=[];this.latestRenderedEntry=this.earliestRenderedEntry=null;this.requestPending=!1;this.lastScrollHeight=0;this.localDateString="";this.callClassMethod(f.superClassName,"initialize");this.$portlet=d("div[data-portlet-type='timeline'][data-portlet-id='"+this.id+"']");this.$portletContainer=d(".ns-timeline-portlet-container",
this.$portlet);this.$portletContainer.empty();this.$portletContainer.append(this.portletBlockingScreen);this.label_show=this.$portletContainer.data("label-show");this.label_date=this.$portletContainer.data("label-date");this.label_no_records=this.$portletContainer.data("label-no-records");this.label_more=this.$portletContainer.data("label-more");this.label_time=this.$portletContainer.data("label-time");this.label_type=this.$portletContainer.data("label-type");this.label_description=this.$portletContainer.data("label-description");
var e=this;d.when(e._getTimelineToday()).then(function(g){e.today=g;e.date=new Date(g[1]);e.datePickerDate=e.$portletContainer.data("today-date");e.$wrapper.on("click",".ns-timeline-date-input, .ns-timeline-date-input-icon",function(c){NS.UIF.load().then(function(b){const a=new b.Component.Calendar({tabbable:!1,visualStyle:b.Component.Calendar.VisualStyle.EMBEDDED,on:{[b.Component.Calendar.Event.DATE_SELECTED]:function(u){e._changeDate(Date.parse(u.currentDate),`${u.currentDate.month+1}/${u.currentDate.day}/${u.currentDate.year}`);
h.close()}}}),h=new b.Component.Popover({owner:e.$wrapper.find(".ns-timeline-date-input-icon")[0],content:a,withAnchor:!0,anchorStyle:u=>u.getComponentStyles(b.Component.Calendar).pickerAnchor,position:{placementOffset:0}});h.open()})});d.when(e._getTimelineTypePrefs()).then(function(c){e.types=c;e._initTypeCaptions();e._renderControlPanel();e._renderHeader();e._renderEmptyTable();e._updateControlPanel();e._renderLoadingMessage();e._renderDate(e.date.getTime(),"")})})};f.reload=function(){this.initialize()};
f._getTimelineData=function(e,g,c){var b=d.Deferred(),a=[];""!==g&&(e=0);this.types.forEach(function(h){h.selected&&a.push(h.entryType)},this);this.getBackend().portletAction(this.getId(),"get-timeline-data",{},{localDate:g,timeInMillis:e,toFuture:c,selectedTypes:a.toString()}).done(function(h){b.resolve(h.info)});return b.promise()};f._getTimelineTypePrefs=function(){var e=d.Deferred();this.getBackend().portletAction(this.getId(),"get-timeline-type-prefs",{},{}).done(function(g){e.resolve(g.types)});
return e.promise()};f._getTimelineToday=function(){var e=d.Deferred();this.getBackend().portletAction(this.getId(),"get-timeline-today",{},{}).done(function(g){e.resolve(g.today)});return e.promise()};f._saveTimelineTypePrefs=function(){var e=d.Deferred(),g=[];this.types.forEach(function(c){c.selected&&g.push(c.entryType)},this);this.getBackend().portletAction(this.getId(),"save-timeline-type-prefs",{},{typesToSave:g.toString()}).done(function(c){e.resolve()});return e.promise()};f._initTypeCaptions=
function(){this.types.forEach(function(e){l[e.entryType]=e.caption},this)};f._changeDate=function(e,g){this.localDateString=this.datePickerDate=g;this.date=new Date(e);this.$dateInput.text(getdatestring(this.date));this.model={};this.latestRenderedEntry=this.earliestRenderedEntry=null;this._renderDate(e,g)};f._labelFirstVisibleRow=function(){for(var e=d("tr",this.$tableContainer),g=0;g<e.length;g++){var c=d(e[g]);if(0<c.position().top-c.height()&&c.position().top<this.$tableContainer.height()){e=
c.data("entry-id");e=this._getLabelsOfEntry(e);c=d("td",c);c[0].textContent=e[0];c[1].textContent=e[1];break}}};f._filterChanged=function(){this.filterChangeTimeout&&clearTimeout(this.filterChangeTimeout);var e=this;this.filterChangeTimeout=setTimeout(function(){e.filterChangeTimeout=null;e.types.forEach(function(g){g.selected=d("#"+g.entryType,e.$portletContainer).prop("checked")});e._saveTimelineTypePrefs();e.earliestRenderedEntry=null;e.latestRenderedEntry=null;e._renderLoadingMessage();d.when(e._getTimelineData(e.date.getTime(),
e.localDateString,!1)).then(function(g){e.model=g;e._renderTable()})},1E3)};f._updateControlPanel=function(){this.types.forEach(function(e){d("#"+e.entryType,this.$portletContainer).prop("checked",e.selected)},this)};f._renderLoadingMessage=function(){this.$tableContainer.empty();this.$tableContainer.append(d(".ns-dashboard-templates > .ns-portlet-loader").clone())};f._renderControlPanel=function(){var e=d(".ns-portlet-control-panel",this.$portlet);0==e.length&&(e=d("<div>",{class:"ns-portlet-control-panel"}));
e.empty();var g=d("<div>",{class:"ns-timeline-header-filters"}),c=d("<div>",{class:"ns-timeline-header-filters-checkboxes"}),b=d("<div>",{class:"ns-timeline-header-date"});g.append(d("<span>",{text:this.label_show+":",class:"ns-timeline-header-label"}));this.types.forEach(function(a){var h=d("<span>",{class:"ns-timeline-header-checkbox"}),u=d("<input/>",{type:"checkbox",id:a.entryType,class:"uir-check-box"}),q=d("<label>");q.append(u);q.append(d("<span>",{text:a.caption}));h.append(q);c.append(h);
u.change(f._filterChanged.bind(this))},this);g.append(c);b.append(d("<span>",{text:this.label_date+":",class:"ns-timeline-header-label"}));this.$dateInput=d("<span>",{text:this.datePickerDate,class:"ns-timeline-date-input"});b.append(this.$dateInput);b.append(d("<div>",{class:"ns-timeline-date-input-icon"}));e.append(g);e.append(b);this.$portletContainer.append(e)};f._renderHeader=function(){var e=d("<div>",{class:"ns-timeline-header-table"}),g=d("<table>",{class:"ns-timeline-table",cellspacing:0,
cellpadding:0});e.append(g);var c=d("<tr>");g.append(c);c.append(d("<td>",{text:this.label_date,class:"ns-timeline-table-date-column"}));c.append(d("<td>",{text:this.label_time,class:"ns-timeline-table-time-column"}));c.append(d("<td>",{text:this.label_type,class:"ns-timeline-table-type-column"}));c.append(d("<td>",{text:this.label_description,class:"ns-timeline-table-details-column"}));this.$portletContainer.append(e)};f._renderEmptyTable=function(){this.$tableContainer=d("<div>",{class:"ns-timeline-table-container"});
var e=this.$tableContainer[0],g=this;e.addEventListener("scroll",function(){0===e.scrollTop?(g.lastScrollHeight=this.scrollHeight,g._scrolledToEnd("top")):e.offsetHeight+e.scrollTop>=e.scrollHeight&&g._scrolledToEnd("bottom")});this.$tableContainer[0].addEventListener("wheel",function(c){function b(h){!g.model||0>=g.model.length?(h.stopPropagation(),h.preventDefault()):0===this.scrollTop?0>h.deltaY&&(g.lastScrollHeight=this.scrollHeight,g._scrolledToEnd("top"),h.stopPropagation(),h.preventDefault()):
this.offsetHeight+this.scrollTop>=this.scrollHeight&&0<h.deltaY&&(g._scrolledToEnd("bottom"),h.stopPropagation(),h.preventDefault())}function a(h){h.stopPropagation();h.preventDefault();var u=this.scrollHeight-this.offsetHeight;this.scrollTop=h=Math.max(0,Math.min(this.scrollTop+(1===h.deltaMode?20*h.deltaY:h.deltaY),u));!g.model||0>=g.model.length||(0===h?(g.lastScrollHeight=this.scrollHeight,g._scrolledToEnd("top")):h>=u&&g._scrolledToEnd("bottom"))}0!==c.deltaY&&(m?a.call(this,c):b.call(this,c))});
this.$portletContainer.append(this.$tableContainer)};f._renderTable=function(){this.$tableContainer.empty();0<this.model.length?(this.$table=d("<table>",{class:"ns-timeline-table",cellspacing:0,cellpadding:0}),this.$tableContainer.append(this.$table),this.model.forEach(function(e){this._renderMonth(e)},this)):this.$tableContainer.append(d("<div>",{text:this.label_no_records,class:"ns-timeline-no-records-message"}))};f._renderMonth=function(e){var g=d("<tr>",{class:"ns-timeline-table-month-row"});
g.append(d("<td>",{text:e.label,class:["ns-timeline-table-month-column"]}));g.append(d("<td>",{class:["ns-timeline-table-time-column"]}));g.append(d("<td>",{class:["ns-timeline-table-type-column"]}));g.append(d("<td>",{class:["ns-timeline-table-details-column"]}));this.$table.append(g);e.days.forEach(function(c){this._renderDay(c)},this)};f._renderDay=function(e){e.timelineEntries.forEach(function(g){this._renderEntry(g,e.label)},this)};f._renderEntry=function(e,g){var c=d("<tr>");c.append(d("<td>",
{text:g,class:"ns-timeline-table-date-column"}));if(!this.earliestRenderedEntry||e.dateTime.millis<this.earliestRenderedEntry.dateTime.millis)this.earliestRenderedEntry=e;if(!this.latestRenderedEntry||e.dateTime.millis>this.latestRenderedEntry.dateTime.millis)this.latestRenderedEntry=e;c.append(d("<td>",{text:e.showTime?e.timeToDisplay:"",class:"ns-timeline-table-time-column"}));c.append(d("<td>",{text:l[e.type],class:"ns-timeline-table-type-column"}));c.append(this._getEntryDetailCell(e));this.today[0]<=
e.dateTime.millis&&this.today[1]>=e.dateTime.millis&&c.addClass("ns-timeline-table-today-row");c.data("entry-id",e.id);this.$table.append(c)};f._renderLoadingButtonRow=function(e,g){e=d("<button>",{text:e});var c=d("<td>",{colspan:5});c.append(e);var b=d("<tr>");b.append(c);e.click(this._loadData.bind(this,g));return b};f._getEntryDetailCell=function(e){var g=null;switch(e.type){case "CALENDAR_EVENT":g=this._renderCalendarEventDetail(e);break;case "CALL":g=this._renderCallDetail(e);break;case "SALES_ORDER":g=
this._renderSalesOrderDetail(e);break;case "ESTIMATE":g=this._renderEstimateDetail(e);break;case "MESSAGE":g=this._renderMessageDetail(e);break;case "CAMPAIGN_RESPONSE":g=this._renderCampaignResponseDetail(e);break;case "SUPPORT_CASE":g=this._renderSupportCaseDetail(e);break;case "SUPPORT_CASE_RESPONSE":g=this._renderSupportCaseResponseDetail(e);break;default:console.error("unsupported entry type: ",e.type)}e=d("<td>",{class:"ns-timeline-table-details-column"});e.append(g);return e};f._renderCalendarEventDetail=
function(e){var g=d("<div>",{class:"ns-timeline-calendar-event-detail"}),c=d("<div>");t(c,e.title,e.title,e.url,"ns-timeline-details-highlighted");k(c,e.organizer,"["+e.organizer+"]","ns-timeline-details-primary");g.append(c);return g};f._renderCallDetail=function(e){var g=d("<div>",{class:"ns-timeline-call-detail"}),c=d("<div>");t(c,e.subject,e.subject,e.url,"ns-timeline-details-highlighted");k(c,e.organizer,"["+e.organizer+"]","ns-timeline-details-primary");g.append(c);e.phoneNumber&&(c=d("<div>"),
c.append(d("<span>",{text:e.phoneNumber,class:"ns-timeline-details-secondary"})),g.append(c));return g};f._renderSalesOrderDetail=function(e){var g=d("<div>",{class:"ns-timeline-sales-order-detail"}),c=d("<div>");t(c,e.id,"#"+e.id,e.url,"ns-timeline-details-highlighted");k(c,e.salesRep,"["+e.salesRep+"]","ns-timeline-details-primary");g.append(c);e.total&&(c=d("<div>"),c.append(d("<span>",{text:"Total:",class:"ns-timeline-details-secondary"})),c.append(d("<span>",{text:e.total,class:"ns-timeline-details-secondary"})),
g.append(c));e.status&&(c=d("<div>"),c.append(d("<span>",{text:"Status:",class:"ns-timeline-details-secondary"})),c.append(d("<span>",{text:e.status,class:"ns-timeline-details-secondary"})),g.append(c));return g};f._renderEstimateDetail=function(e){var g=d("<div>",{class:"ns-timeline-estimate-detail"}),c=d("<div>");t(c,e.id,"#"+e.id,e.url,"ns-timeline-details-highlighted");k(c,e.title,e.title,"ns-timeline-details-highlighted");k(c,e.salesRep,"["+e.salesRep+"]","ns-timeline-details-primary");g.append(c);
e.total&&(c=d("<div>"),c.append(d("<span>",{text:"Total:",class:"ns-timeline-details-secondary"})),c.append(d("<span>",{text:e.total,class:"ns-timeline-details-secondary"})),g.append(c));e.status&&(c=d("<div>"),c.append(d("<span>",{text:"Status:",class:"ns-timeline-details-secondary"})),c.append(d("<span>",{text:e.status,class:"ns-timeline-details-secondary"})),g.append(c));return g};f._renderMessageDetail=function(e){var g=d("<div>",{class:"ns-timeline-message-detail"}),c=d("<div>");t(c,e.subject,
e.subject,e.url,"ns-timeline-details-highlighted");g.append(c);n(g,e);return g};f._renderCampaignResponseDetail=function(e){var g=d("<div>",{class:"ns-timeline-campaign-response-detail"}),c=d("<div>");t(c,e.responseDetail,e.responseDetail,e.url,"ns-timeline-details-highlighted");k(c,e.campaignResponseAuthor,"["+e.campaignResponseAuthor+"]","ns-timeline-details-primary");g.append(c);e.campaignTitle&&(c=d("<div>"),c.append(d("<span>",{text:"Campaign:",class:"ns-timeline-details-secondary"})),c.append(d("<span>",
{text:e.campaignTitle,class:"ns-timeline-details-secondary"})),g.append(c));e.campaignEventTitle&&(c=d("<div>"),c.append(d("<span>",{text:"Campaign Event:",class:"ns-timeline-details-secondary"})),c.append(d("<span>",{text:e.campaignEventTitle,class:"ns-timeline-details-secondary"})),g.append(c));return g};f._renderSupportCaseDetail=function(e){var g=d("<div>",{class:"ns-timeline-support-case-detail"}),c=d("<div>");t(c,e.supportCaseNumber,"#"+e.supportCaseNumber,e.url,"ns-timeline-details-highlighted");
k(c,e.subject,e.subject,"ns-timeline-details-primary");k(c,e.assignedTo,"["+e.assignedTo+"]","ns-timeline-details-primary");g.append(c);e.status&&(c=d("<div>"),c.append(d("<span>",{text:"Status:",class:"ns-timeline-details-secondary"})),c.append(d("<span>",{text:e.status,class:"ns-timeline-details-secondary"})),g.append(c));e.priority&&(c=d("<div>"),c.append(d("<span>",{text:"Priority:",class:"ns-timeline-details-secondary"})),c.append(d("<span>",{text:e.priority,class:"ns-timeline-details-secondary"})),
g.append(c));return g};f._renderSupportCaseResponseDetail=function(e){var g=d("<div>",{class:"ns-timeline-support-case-response-detail"}),c=d("<div>");t(c,e.caseNum,"#"+e.caseNum,e.url,"ns-timeline-details-highlighted");k(c,e.caseSubject,e.caseSubject,"ns-timeline-details-primary");g.append(c);n(g,e);return g};f._scrolledToEnd=function(e){this._loadData(e)};f._loadData=function(e){var g=this;!1===this.requestPending&&("bottom"===e&&this.earliestRenderedEntry?(this.requestPending=!0,d.when(this._getTimelineData(g.earliestRenderedEntry.dateTime.millis-
1E3,"",!1)).then(function(c){g.requestPending=!1;g._addToModel(c,!1);g._renderTable()})):"top"===e&&this.latestRenderedEntry&&(this.requestPending=!0,d.when(this._getTimelineData(g.latestRenderedEntry.dateTime.millis+1E3,"",!0)).then(function(c){g.requestPending=!1;g._addToModel(c,!0);g._renderTable();g.$tableContainer.scrollTop(g.$tableContainer[0].scrollHeight-g.lastScrollHeight)})))};f._addToModel=function(e,g){if(g){var c=this.model[0].days;e.reverse().forEach(function(a){a.label===this.model[0].label?
a.days.reverse().forEach(function(h){h.label===c[0].label?c[0].timelineEntries=c[0].timelineEntries.concat(h.timelineEntries):c.unshift(h)},this):this.model.unshift(a)},this)}else{var b=this.model[this.model.length-1].days;e.forEach(function(a){a.label===this.model[this.model.length-1].label?a.days.forEach(function(h){h.label===b[b.length-1].label?b[b.length-1].timelineEntries=b[b.length-1].timelineEntries.concat(h.timelineEntries):b.push(h)},this):this.model.push(a)},this)}};f._getLabelsOfEntry=
function(e){var g=[];this.model.forEach(function(c){c.days.forEach(function(b){b.timelineEntries.forEach(function(a){a.id===e&&(g.push(c.label),g.push(b.label))},this)},this)},this);return g};f._renderDate=function(e,g){var c=this;d.when(this._getTimelineData(e,g,!1)).then(function(b){c.model=b;0<c.model.length?c._renderTable():d.when(c._getTimelineData(e,g,!0)).then(function(a){c.model=a;c._renderTable();c.$tableContainer.scrollTop(c.$tableContainer[0].scrollHeight);c._labelFirstVisibleRow()})})}})(this,
NS.jQuery);
//# sourceMappingURL=/assets/dashboard_legacy_core/4273734933.map